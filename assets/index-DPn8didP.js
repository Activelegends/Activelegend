import{j as l,q as Te,a as fi,A as Ft,_ as zt,m as F,u as gi,b as mi,c as pi}from"./ui-BdGUOZzr.js";import{c as yi,g as vi,d as bi,a as T,R as B,L as ye,u as wi,f as bs,h as _i,H as xi,i as ji,j as at}from"./vendor-czbhVbzW.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var xt={},Fs;function ki(){if(Fs)return xt;Fs=1;var s=yi();return xt.createRoot=s.createRoot,xt.hydrateRoot=s.hydrateRoot,xt}var Si=ki();const Ai="modulepreload",Ei=function(s){return"/"+s},Ds={},yt=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let a=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=a(t.map(u=>{if(u=Ei(u),u in Ds)return;Ds[u]=!0;const d=u.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":Ai,d||(g.as="script"),g.crossOrigin="",g.href=u,c&&g.setAttribute("nonce",c),document.head.appendChild(g),d)return new Promise((m,v)=>{g.addEventListener("load",m),g.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${u}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})},Ci=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>yt(async()=>{const{default:r}=await Promise.resolve().then(()=>it);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class ws extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Oi extends ws{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ti extends ws{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ni extends ws{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var os;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(os||(os={}));var Ii=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(r.next(d))}catch(f){a(f)}}function c(d){try{u(r.throw(d))}catch(f){a(f)}}function u(d){d.done?n(d.value):i(d.value).then(o,c)}u((r=r.apply(s,e||[])).next())})};class Pi{constructor(e,{headers:t={},customFetch:r,region:i=os.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Ci(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Ii(this,void 0,void 0,function*(){try{const{headers:i,method:n,body:a}=t;let o={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let u;a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",u=a):typeof a=="string"?(o["Content-Type"]="text/plain",u=a):typeof FormData<"u"&&a instanceof FormData?u=a:(o["Content-Type"]="application/json",u=JSON.stringify(a)));const d=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:u}).catch(v=>{throw new Oi(v)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new Ti(d);if(!d.ok)throw new Ni(d);let g=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),m;return g==="application/json"?m=yield d.json():g==="application/octet-stream"?m=yield d.blob():g==="text/event-stream"?m=d:g==="multipart/form-data"?m=yield d.formData():m=yield d.text(),{data:m,error:null}}catch(i){return{data:null,error:i}}})}}var se={},qe={},ze={},He={},We={},Je={},Ri=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},rt=Ri();const $i=rt.fetch,jr=rt.fetch.bind(rt),kr=rt.Headers,Li=rt.Request,Fi=rt.Response,it=Object.freeze(Object.defineProperty({__proto__:null,Headers:kr,Request:Li,Response:Fi,default:jr,fetch:$i},Symbol.toStringTag,{value:"Module"})),Di=vi(it);var jt={},Us;function Sr(){if(Us)return jt;Us=1,Object.defineProperty(jt,"__esModule",{value:!0});class s extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return jt.default=s,jt}var Bs;function Ar(){if(Bs)return Je;Bs=1;var s=Je&&Je.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Je,"__esModule",{value:!0});const e=s(Di),t=s(Sr());class r{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,a){return this.headers=Object.assign({},this.headers),this.headers[n]=a,this}then(n,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const o=this.fetch;let c=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var d,f,g;let m=null,v=null,b=null,_=u.status,N=u.statusText;if(u.ok){if(this.method!=="HEAD"){const L=await u.text();L===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?v=L:v=JSON.parse(L))}const k=(d=this.headers.Prefer)===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),$=(f=u.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");k&&$&&$.length>1&&(b=parseInt($[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(v)&&(v.length>1?(m={code:"PGRST116",details:`Results contain ${v.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},v=null,b=null,_=406,N="Not Acceptable"):v.length===1?v=v[0]:v=null)}else{const k=await u.text();try{m=JSON.parse(k),Array.isArray(m)&&u.status===404&&(v=[],m=null,_=200,N="OK")}catch{u.status===404&&k===""?(_=204,N="No Content"):m={message:k}}if(m&&this.isMaybeSingle&&(!((g=m==null?void 0:m.details)===null||g===void 0)&&g.includes("0 rows"))&&(m=null,_=200,N="OK"),m&&this.shouldThrowOnError)throw new t.default(m)}return{error:m,data:v,count:b,status:_,statusText:N}});return this.shouldThrowOnError||(c=c.catch(u=>{var d,f,g;return{error:{message:`${(d=u==null?void 0:u.name)!==null&&d!==void 0?d:"FetchError"}: ${u==null?void 0:u.message}`,details:`${(f=u==null?void 0:u.stack)!==null&&f!==void 0?f:""}`,hint:"",code:`${(g=u==null?void 0:u.code)!==null&&g!==void 0?g:""}`},data:null,count:null,status:0,statusText:""}})),c.then(n,a)}returns(){return this}overrideTypes(){return this}}return Je.default=r,Je}var Ms;function Er(){if(Ms)return We;Ms=1;var s=We&&We.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(We,"__esModule",{value:!0});const e=s(Ar());class t extends e.default{select(i){let n=!1;const a=(i??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(i,{ascending:n=!0,nullsFirst:a,foreignTable:o,referencedTable:c=o}={}){const u=c?`${c}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${i}.${n?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:n,referencedTable:a=n}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${i}`),this}range(i,n,{foreignTable:a,referencedTable:o=a}={}){const c=typeof o>"u"?"offset":`${o}.offset`,u=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${i}`),this.url.searchParams.set(u,`${n-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:i=!1,verbose:n=!1,settings:a=!1,buffers:o=!1,wal:c=!1,format:u="text"}={}){var d;const f=[i?"analyze":null,n?"verbose":null,a?"settings":null,o?"buffers":null,c?"wal":null].filter(Boolean).join("|"),g=(d=this.headers.Accept)!==null&&d!==void 0?d:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${g}"; options=${f};`,u==="json"?this:this}rollback(){var i;return((i=this.headers.Prefer)!==null&&i!==void 0?i:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return We.default=t,We}var Vs;function _s(){if(Vs)return He;Vs=1;var s=He&&He.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(He,"__esModule",{value:!0});const e=s(Er());class t extends e.default{eq(i,n){return this.url.searchParams.append(i,`eq.${n}`),this}neq(i,n){return this.url.searchParams.append(i,`neq.${n}`),this}gt(i,n){return this.url.searchParams.append(i,`gt.${n}`),this}gte(i,n){return this.url.searchParams.append(i,`gte.${n}`),this}lt(i,n){return this.url.searchParams.append(i,`lt.${n}`),this}lte(i,n){return this.url.searchParams.append(i,`lte.${n}`),this}like(i,n){return this.url.searchParams.append(i,`like.${n}`),this}likeAllOf(i,n){return this.url.searchParams.append(i,`like(all).{${n.join(",")}}`),this}likeAnyOf(i,n){return this.url.searchParams.append(i,`like(any).{${n.join(",")}}`),this}ilike(i,n){return this.url.searchParams.append(i,`ilike.${n}`),this}ilikeAllOf(i,n){return this.url.searchParams.append(i,`ilike(all).{${n.join(",")}}`),this}ilikeAnyOf(i,n){return this.url.searchParams.append(i,`ilike(any).{${n.join(",")}}`),this}is(i,n){return this.url.searchParams.append(i,`is.${n}`),this}in(i,n){const a=Array.from(new Set(n)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(i,`in.(${a})`),this}contains(i,n){return typeof n=="string"?this.url.searchParams.append(i,`cs.${n}`):Array.isArray(n)?this.url.searchParams.append(i,`cs.{${n.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(n)}`),this}containedBy(i,n){return typeof n=="string"?this.url.searchParams.append(i,`cd.${n}`):Array.isArray(n)?this.url.searchParams.append(i,`cd.{${n.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(n)}`),this}rangeGt(i,n){return this.url.searchParams.append(i,`sr.${n}`),this}rangeGte(i,n){return this.url.searchParams.append(i,`nxl.${n}`),this}rangeLt(i,n){return this.url.searchParams.append(i,`sl.${n}`),this}rangeLte(i,n){return this.url.searchParams.append(i,`nxr.${n}`),this}rangeAdjacent(i,n){return this.url.searchParams.append(i,`adj.${n}`),this}overlaps(i,n){return typeof n=="string"?this.url.searchParams.append(i,`ov.${n}`):this.url.searchParams.append(i,`ov.{${n.join(",")}}`),this}textSearch(i,n,{config:a,type:o}={}){let c="";o==="plain"?c="pl":o==="phrase"?c="ph":o==="websearch"&&(c="w");const u=a===void 0?"":`(${a})`;return this.url.searchParams.append(i,`${c}fts${u}.${n}`),this}match(i){return Object.entries(i).forEach(([n,a])=>{this.url.searchParams.append(n,`eq.${a}`)}),this}not(i,n,a){return this.url.searchParams.append(i,`not.${n}.${a}`),this}or(i,{foreignTable:n,referencedTable:a=n}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${i})`),this}filter(i,n,a){return this.url.searchParams.append(i,`${n}.${a}`),this}}return He.default=t,He}var qs;function Cr(){if(qs)return ze;qs=1;var s=ze&&ze.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ze,"__esModule",{value:!0});const e=s(_s());class t{constructor(i,{headers:n={},schema:a,fetch:o}){this.url=i,this.headers=n,this.schema=a,this.fetch=o}select(i,{head:n=!1,count:a}={}){const o=n?"HEAD":"GET";let c=!1;const u=(i??"*").split("").map(d=>/\s/.test(d)&&!c?"":(d==='"'&&(c=!c),d)).join("");return this.url.searchParams.set("select",u),a&&(this.headers.Prefer=`count=${a}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(i,{count:n,defaultToNull:a=!0}={}){const o="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),n&&c.push(`count=${n}`),a||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(i)){const u=i.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(u.length>0){const d=[...new Set(u)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:this.fetch,allowEmpty:!1})}upsert(i,{onConflict:n,ignoreDuplicates:a=!1,count:o,defaultToNull:c=!0}={}){const u="POST",d=[`resolution=${a?"ignore":"merge"}-duplicates`];if(n!==void 0&&this.url.searchParams.set("on_conflict",n),this.headers.Prefer&&d.push(this.headers.Prefer),o&&d.push(`count=${o}`),c||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(i)){const f=i.reduce((g,m)=>g.concat(Object.keys(m)),[]);if(f.length>0){const g=[...new Set(f)].map(m=>`"${m}"`);this.url.searchParams.set("columns",g.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:this.fetch,allowEmpty:!1})}update(i,{count:n}={}){const a="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),n&&o.push(`count=${n}`),this.headers.Prefer=o.join(","),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:this.fetch,allowEmpty:!1})}delete({count:i}={}){const n="DELETE",a=[];return i&&a.push(`count=${i}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new e.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return ze.default=t,ze}var ot={},lt={},zs;function Ui(){return zs||(zs=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.version=void 0,lt.version="0.0.0-automated"),lt}var Hs;function Bi(){if(Hs)return ot;Hs=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.DEFAULT_HEADERS=void 0;const s=Ui();return ot.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${s.version}`},ot}var Ws;function Mi(){if(Ws)return qe;Ws=1;var s=qe&&qe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(qe,"__esModule",{value:!0});const e=s(Cr()),t=s(_s()),r=Bi();class i{constructor(a,{headers:o={},schema:c,fetch:u}={}){this.url=a,this.headers=Object.assign(Object.assign({},r.DEFAULT_HEADERS),o),this.schemaName=c,this.fetch=u}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new i(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:c=!1,get:u=!1,count:d}={}){let f;const g=new URL(`${this.url}/rpc/${a}`);let m;c||u?(f=c?"HEAD":"GET",Object.entries(o).filter(([b,_])=>_!==void 0).map(([b,_])=>[b,Array.isArray(_)?`{${_.join(",")}}`:`${_}`]).forEach(([b,_])=>{g.searchParams.append(b,_)})):(f="POST",m=o);const v=Object.assign({},this.headers);return d&&(v.Prefer=`count=${d}`),new t.default({method:f,url:g,headers:v,schema:this.schemaName,body:m,fetch:this.fetch,allowEmpty:!1})}}return qe.default=i,qe}var Js;function Vi(){if(Js)return se;Js=1;var s=se&&se.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(se,"__esModule",{value:!0}),se.PostgrestError=se.PostgrestBuilder=se.PostgrestTransformBuilder=se.PostgrestFilterBuilder=se.PostgrestQueryBuilder=se.PostgrestClient=void 0;const e=s(Mi());se.PostgrestClient=e.default;const t=s(Cr());se.PostgrestQueryBuilder=t.default;const r=s(_s());se.PostgrestFilterBuilder=r.default;const i=s(Er());se.PostgrestTransformBuilder=i.default;const n=s(Ar());se.PostgrestBuilder=n.default;const a=s(Sr());return se.PostgrestError=a.default,se.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:n.default,PostgrestError:a.default},se}var qi=Vi();const zi=bi(qi),{PostgrestClient:Hi,PostgrestQueryBuilder:Ko,PostgrestFilterBuilder:Yo,PostgrestTransformBuilder:Qo,PostgrestBuilder:Xo,PostgrestError:Zo}=zi;let ls;typeof window>"u"?ls=require("ws"):ls=window.WebSocket;const Wi="2.11.10",Ji={"X-Client-Info":`realtime-js/${Wi}`},Gi="1.0.0",Or=1e4,Ki=1e3;var tt;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(tt||(tt={}));var oe;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(oe||(oe={}));var _e;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(_e||(_e={}));var cs;(function(s){s.websocket="websocket"})(cs||(cs={}));var Be;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Be||(Be={}));class Yi{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const i=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+i));a=a+i;const c=r.decode(e.slice(a,a+n));a=a+n;const u=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:u}}}class Tr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var G;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(G||(G={}));const Gs=(s,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((n,a)=>(n[a]=Qi(a,s,e,i),n),{})},Qi=(s,e,t,r)=>{const i=e.find(o=>o.name===s),n=i==null?void 0:i.type,a=t[s];return n&&!r.includes(n)?Nr(n,a):us(a)},Nr=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return tn(e,t)}switch(s){case G.bool:return Xi(e);case G.float4:case G.float8:case G.int2:case G.int4:case G.int8:case G.numeric:case G.oid:return Zi(e);case G.json:case G.jsonb:return en(e);case G.timestamp:return sn(e);case G.abstime:case G.date:case G.daterange:case G.int4range:case G.int8range:case G.money:case G.reltime:case G.text:case G.time:case G.timestamptz:case G.timetz:case G.tsrange:case G.tstzrange:return us(e);default:return us(e)}},us=s=>s,Xi=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Zi=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},en=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},tn=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,r=s[t];if(s[0]==="{"&&r==="}"){let n;const a=s.slice(1,t);try{n=JSON.parse("["+a+"]")}catch{n=a?a.split(","):[]}return n.map(o=>Nr(e,o))}return s},sn=s=>typeof s=="string"?s.replace(" ","T"):s,Ir=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Ht{constructor(e,t,r={},i=Or){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ks;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(Ks||(Ks={}));class ft{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ft.syncState(this.state,i,n,a),this.pendingDiffs.forEach(c=>{this.state=ft.syncDiff(this.state,c,n,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=ft.syncDiff(this.state,i,n,a),o())}),this.onJoin((i,n,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:a})}),this.onLeave((i,n,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const n=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(n,(u,d)=>{a[u]||(c[u]=d)}),this.map(a,(u,d)=>{const f=n[u];if(f){const g=d.map(_=>_.presence_ref),m=f.map(_=>_.presence_ref),v=d.filter(_=>m.indexOf(_.presence_ref)<0),b=f.filter(_=>g.indexOf(_.presence_ref)<0);v.length>0&&(o[u]=v),b.length>0&&(c[u]=b)}else o[u]=d}),this.syncDiff(n,{joins:o,leaves:c},r,i)}static syncDiff(e,t,r,i){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(n,(o,c)=>{var u;const d=(u=e[o])!==null&&u!==void 0?u:[];if(e[o]=this.cloneDeep(c),d.length>0){const f=e[o].map(m=>m.presence_ref),g=d.filter(m=>f.indexOf(m.presence_ref)<0);e[o].unshift(...g)}r(o,d,c)}),this.map(a,(o,c)=>{let u=e[o];if(!u)return;const d=c.map(f=>f.presence_ref);u=u.filter(f=>d.indexOf(f.presence_ref)<0),e[o]=u,i(o,u,c),u.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ys;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(Ys||(Ys={}));var Qs;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Qs||(Qs={}));var Ee;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Ee||(Ee={}));class xs{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=oe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ht(this,_e.join,this.params,this.timeout),this.rejoinTimer=new Tr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=oe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=oe.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=oe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=oe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(_e.reply,{},(i,n)=>{this._trigger(this._replyEventName(n),i)}),this.presence=new ft(this),this.broadcastEndpointURL=Ir(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:a,private:o}}=this.params;this._onError(d=>e==null?void 0:e(Ee.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(Ee.CLOSED));const c={},u={broadcast:n,presence:a,postgres_changes:(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(d=>d.filter))!==null&&i!==void 0?i:[],private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var f;if(this.socket.setAuth(),d===void 0){e==null||e(Ee.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,m=(f=g==null?void 0:g.length)!==null&&f!==void 0?f:0,v=[];for(let b=0;b<m;b++){const _=g[b],{filter:{event:N,schema:j,table:k,filter:$}}=_,L=d&&d[b];if(L&&L.event===N&&L.schema===j&&L.table===k&&L.filter===$)v.push(Object.assign(Object.assign({},_),{id:L.id}));else{this.unsubscribe(),this.state=oe.errored,e==null||e(Ee.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(Ee.SUBSCRIBED);return}}).receive("error",d=>{this.state=oe.errored,e==null||e(Ee.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ee.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=u.body)===null||i===void 0?void 0:i.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var a,o,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&n("ok"),u.receive("ok",()=>n("ok")),u.receive("error",()=>n("error")),u.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=oe.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(_e.close,"leave",this._joinRef())};return this.joinPush.destroy(),new Promise(r=>{const i=new Ht(this,_e.leave,{},e);i.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,r){const i=new AbortController,n=setTimeout(()=>i.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Ht(this,e,t,r);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,n;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:u,join:d}=_e;if(r&&[o,c,u,d].indexOf(a)>=0&&r!==this._joinRef())return;let g=this._onMessage(a,t,r);if(t&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(m=>{var v,b,_;return((v=m.filter)===null||v===void 0?void 0:v.event)==="*"||((_=(b=m.filter)===null||b===void 0?void 0:b.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===a}).map(m=>m.callback(g,r)):(n=this.bindings[a])===null||n===void 0||n.filter(m=>{var v,b,_,N,j,k;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const $=m.id,L=(v=m.filter)===null||v===void 0?void 0:v.event;return $&&((b=t.ids)===null||b===void 0?void 0:b.includes($))&&(L==="*"||(L==null?void 0:L.toLocaleLowerCase())===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const $=(j=(N=m==null?void 0:m.filter)===null||N===void 0?void 0:N.event)===null||j===void 0?void 0:j.toLocaleLowerCase();return $==="*"||$===((k=t==null?void 0:t.event)===null||k===void 0?void 0:k.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof g=="object"&&"ids"in g){const v=g.data,{schema:b,table:_,commit_timestamp:N,type:j,errors:k}=v;g=Object.assign(Object.assign({},{schema:b,table:_,commit_timestamp:N,eventType:j,new:{},old:{},errors:k}),this._getPayloadRecords(v))}m.callback(g,r)})}_isClosed(){return this.state===oe.closed}_isJoined(){return this.state===oe.joined}_isJoining(){return this.state===oe.joining}_isLeaving(){return this.state===oe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&xs.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(_e.close,{},e)}_onError(e){this._on(_e.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=oe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Gs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Gs(e.columns,e.old_record)),t}}const Xs=()=>{},rn=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class nn{constructor(e,t){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers=Ji,this.params={},this.timeout=Or,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Xs,this.ref=0,this.logger=Xs,this.conn=null,this.sendBuffer=[],this.serializer=new Yi,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=n=>{let a;return n?a=n:typeof fetch>"u"?a=(...o)=>yt(async()=>{const{default:c}=await Promise.resolve().then(()=>it);return{default:c}},void 0).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${cs.websocket}`,this.httpEndpoint=Ir(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,a)=>a(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Tr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=ls),this.transport){typeof window<"u"&&this.transport===window.WebSocket?this.conn=new this.transport(this.endpointURL()):this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection();return}this.conn=new an(this.endpointURL(),void 0,{close:()=>{this.conn=null}})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Gi}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(r=>r.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels=this.channels.filter(r=>r._joinRef!==e._joinRef),this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case tt.connecting:return Be.Connecting;case tt.open:return Be.Open;case tt.closing:return Be.Closing;default:return Be.Closed}}isConnected(){return this.connectionState()===Be.Open}channel(e,t={config:{}}){const r=`realtime:${e}`,i=this.getChannels().find(n=>n.topic===r);if(i)return i;{const n=new xs(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:r,payload:i,ref:n}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${r} (${n})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{t&&r.updateJoinPayload({access_token:t,version:this.headers&&this.headers["X-Client-Info"]}),r.joinedOnce&&r._isJoined()&&r._push(_e.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Ki,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:i,payload:n,ref:a}=t;r==="phoenix"&&i==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${r} ${i} ${a&&"("+a+")"||""}`,n),Array.from(this.channels).filter(o=>o._isMember(r)).forEach(o=>o._trigger(i,n,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(_e.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([rn],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}}class an{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=tt.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class js extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function re(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class on extends js{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ds extends js{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var ln=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(r.next(d))}catch(f){a(f)}}function c(d){try{u(r.throw(d))}catch(f){a(f)}}function u(d){d.done?n(d.value):i(d.value).then(o,c)}u((r=r.apply(s,e||[])).next())})};const Pr=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>yt(async()=>{const{default:r}=await Promise.resolve().then(()=>it);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},cn=()=>ln(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield yt(()=>Promise.resolve().then(()=>it),void 0)).Response:Response}),hs=s=>{if(Array.isArray(s))return s.map(t=>hs(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[i]=hs(r)}),e};var Ve=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(r.next(d))}catch(f){a(f)}}function c(d){try{u(r.throw(d))}catch(f){a(f)}}function u(d){d.done?n(d.value):i(d.value).then(o,c)}u((r=r.apply(s,e||[])).next())})};const Wt=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),un=(s,e,t)=>Ve(void 0,void 0,void 0,function*(){const r=yield cn();s instanceof r&&!(t!=null&&t.noResolveJson)?s.json().then(i=>{e(new on(Wt(i),s.status||500))}).catch(i=>{e(new ds(Wt(i),i))}):e(new ds(Wt(s),s))}),dn=(s,e,t,r)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r&&(i.body=JSON.stringify(r)),Object.assign(Object.assign({},i),t))};function vt(s,e,t,r,i,n){return Ve(this,void 0,void 0,function*(){return new Promise((a,o)=>{s(t,dn(e,r,i,n)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>un(c,o,r))})})}function Tt(s,e,t,r){return Ve(this,void 0,void 0,function*(){return vt(s,"GET",e,t,r)})}function Pe(s,e,t,r,i){return Ve(this,void 0,void 0,function*(){return vt(s,"POST",e,r,i,t)})}function hn(s,e,t,r,i){return Ve(this,void 0,void 0,function*(){return vt(s,"PUT",e,r,i,t)})}function fn(s,e,t,r){return Ve(this,void 0,void 0,function*(){return vt(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function Rr(s,e,t,r,i){return Ve(this,void 0,void 0,function*(){return vt(s,"DELETE",e,r,i,t)})}var fe=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(r.next(d))}catch(f){a(f)}}function c(d){try{u(r.throw(d))}catch(f){a(f)}}function u(d){d.done?n(d.value):i(d.value).then(o,c)}u((r=r.apply(s,e||[])).next())})};const gn={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Zs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class mn{constructor(e,t={},r,i){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Pr(i)}uploadOrUpdate(e,t,r,i){return fe(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},Zs),i);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),c&&n.append("metadata",this.encodeMetadata(c)),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",a.cacheControl),c&&n.append("metadata",this.encodeMetadata(c))):(n=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),i!=null&&i.headers&&(o=Object.assign(Object.assign({},o),i.headers));const u=this._removeEmptyFolders(t),d=this._getFinalPath(u),f=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:n,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),g=yield f.json();return f.ok?{data:{path:u,id:g.Id,fullPath:g.Key},error:null}:{data:null,error:g}}catch(n){if(re(n))return{data:null,error:n};throw n}})}upload(e,t,r){return fe(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,i){return fe(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:Zs.upsert},i),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const f=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:d}),g=yield f.json();return f.ok?{data:{path:n,fullPath:g.Key},error:null}:{data:null,error:g}}catch(c){if(re(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return fe(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const n=yield Pe(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),a=new URL(this.url+n.url),o=a.searchParams.get("token");if(!o)throw new js("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}update(e,t,r){return fe(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return fe(this,void 0,void 0,function*(){try{return{data:yield Pe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(re(i))return{data:null,error:i};throw i}})}copy(e,t,r){return fe(this,void 0,void 0,function*(){try{return{data:{path:(yield Pe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(re(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,r){return fe(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield Pe(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(i){if(re(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return fe(this,void 0,void 0,function*(){try{const i=yield Pe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${n}`):null})),error:null}}catch(i){if(re(i))return{data:null,error:i};throw i}})}download(e,t){return fe(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=n?`?${n}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield Tt(this.fetch,`${this.url}/${i}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(re(o))return{data:null,error:o};throw o}})}info(e){return fe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Tt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:hs(r),error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}exists(e){return fe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield fn(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(re(r)&&r instanceof ds){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&i.push(c);let u=i.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${u}`)}}}remove(e){return fe(this,void 0,void 0,function*(){try{return{data:yield Rr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}list(e,t,r){return fe(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},gn),t),{prefix:e||""});return{data:yield Pe(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(re(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const pn="2.7.1",yn={"X-Client-Info":`storage-js/${pn}`};var Ge=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(r.next(d))}catch(f){a(f)}}function c(d){try{u(r.throw(d))}catch(f){a(f)}}function u(d){d.done?n(d.value):i(d.value).then(o,c)}u((r=r.apply(s,e||[])).next())})};class vn{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},yn),t),this.fetch=Pr(r)}listBuckets(){return Ge(this,void 0,void 0,function*(){try{return{data:yield Tt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(re(e))return{data:null,error:e};throw e}})}getBucket(e){return Ge(this,void 0,void 0,function*(){try{return{data:yield Tt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ge(this,void 0,void 0,function*(){try{return{data:yield Pe(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Ge(this,void 0,void 0,function*(){try{return{data:yield hn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(re(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Ge(this,void 0,void 0,function*(){try{return{data:yield Pe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ge(this,void 0,void 0,function*(){try{return{data:yield Rr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(re(t))return{data:null,error:t};throw t}})}}class bn extends vn{constructor(e,t={},r){super(e,t,r)}from(e){return new mn(this.url,this.headers,e,this.fetch)}}const wn="2.50.0";let ht="";typeof Deno<"u"?ht="deno":typeof document<"u"?ht="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ht="react-native":ht="node";const _n={"X-Client-Info":`supabase-js-${ht}/${wn}`},xn={headers:_n},jn={schema:"public"},kn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Sn={};var An=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(r.next(d))}catch(f){a(f)}}function c(d){try{u(r.throw(d))}catch(f){a(f)}}function u(d){d.done?n(d.value):i(d.value).then(o,c)}u((r=r.apply(s,e||[])).next())})};const En=s=>{let e;return s?e=s:typeof fetch>"u"?e=jr:e=fetch,(...t)=>e(...t)},Cn=()=>typeof Headers>"u"?kr:Headers,On=(s,e,t)=>{const r=En(t),i=Cn();return(n,a)=>An(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:s;let u=new i(a==null?void 0:a.headers);return u.has("apikey")||u.set("apikey",s),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(n,Object.assign(Object.assign({},a),{headers:u}))})};var Tn=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(r.next(d))}catch(f){a(f)}}function c(d){try{u(r.throw(d))}catch(f){a(f)}}function u(d){d.done?n(d.value):i(d.value).then(o,c)}u((r=r.apply(s,e||[])).next())})};function Nn(s){return s.endsWith("/")?s:s+"/"}function In(s,e){var t,r;const{db:i,auth:n,realtime:a,global:o}=s,{db:c,auth:u,realtime:d,global:f}=e,g={db:Object.assign(Object.assign({},c),i),auth:Object.assign(Object.assign({},u),n),realtime:Object.assign(Object.assign({},d),a),global:Object.assign(Object.assign(Object.assign({},f),o),{headers:Object.assign(Object.assign({},(t=f==null?void 0:f.headers)!==null&&t!==void 0?t:{}),(r=o==null?void 0:o.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Tn(this,void 0,void 0,function*(){return""})};return s.accessToken?g.accessToken=s.accessToken:delete g.accessToken,g}const $r="2.70.0",Ze=30*1e3,fs=3,Jt=fs*Ze,Pn="http://localhost:9999",Rn="supabase.auth.token",$n={"X-Client-Info":`gotrue-js/${$r}`},gs="X-Supabase-Api-Version",Lr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Ln=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Fn=6e5;class ks extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function D(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class Dn extends ks{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Un(s){return D(s)&&s.name==="AuthApiError"}class Fr extends ks{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Le extends ks{constructor(e,t,r,i){super(e,r,i),this.name=t,this.status=r}}class Ie extends Le{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Bn(s){return D(s)&&s.name==="AuthSessionMissingError"}class kt extends Le{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class St extends Le{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class At extends Le{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Mn(s){return D(s)&&s.name==="AuthImplicitGrantRedirectError"}class er extends Le{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ms extends Le{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Gt(s){return D(s)&&s.name==="AuthRetryableFetchError"}class tr extends Le{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class gt extends Le{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),sr=` 	
\r=`.split(""),Vn=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<sr.length;e+=1)s[sr[e].charCodeAt(0)]=-2;for(let e=0;e<Nt.length;e+=1)s[Nt[e].charCodeAt(0)]=e;return s})();function rr(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Nt[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Nt[r]),e.queuedBits-=6}}function Dr(s,e,t){const r=Vn[s];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function ir(s){const e=[],t=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=a=>{Hn(a,r,t)};for(let a=0;a<s.length;a+=1)Dr(s.charCodeAt(a),i,n);return e.join("")}function qn(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function zn(s,e){for(let t=0;t<s.length;t+=1){let r=s.charCodeAt(t);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(s.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}qn(r,e)}}function Hn(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let r=1;r<6;r+=1)if((s>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Wn(s){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<s.length;i+=1)Dr(s.charCodeAt(i),t,r);return new Uint8Array(e)}function Jn(s){const e=[];return zn(s,t=>e.push(t)),new Uint8Array(e)}function Gn(s){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};return s.forEach(i=>rr(i,t,r)),rr(null,t,r),e.join("")}function Kn(s){return Math.round(Date.now()/1e3)+s}function Yn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const we=()=>typeof window<"u"&&typeof document<"u",Fe={tested:!1,writable:!1},mt=()=>{if(!we())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Fe.tested)return Fe.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),Fe.tested=!0,Fe.writable=!0}catch{Fe.tested=!0,Fe.writable=!1}return Fe.writable};function Qn(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const Ur=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>yt(async()=>{const{default:r}=await Promise.resolve().then(()=>it);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Xn=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",Br=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},Et=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ct=async(s,e)=>{await s.removeItem(e)};class Dt{constructor(){this.promise=new Dt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Dt.promiseConstructor=Promise;function Kt(s){const e=s.split(".");if(e.length!==3)throw new gt("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Ln.test(e[r]))throw new gt("JWT not in base64url format");return{header:JSON.parse(ir(e[0])),payload:JSON.parse(ir(e[1])),signature:Wn(e[2]),raw:{header:e[0],payload:e[1]}}}async function Zn(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function ea(s,e){return new Promise((r,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await s(n);if(!e(n,null,a)){r(a);return}}catch(a){if(!e(n,a)){i(a);return}}})()})}function ta(s){return("0"+s.toString(16)).substr(-2)}function sa(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,ta).join("")}async function ra(s){const t=new TextEncoder().encode(s),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}async function ia(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await ra(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ke(s,e,t=!1){const r=sa();let i=r;t&&(i+="/PASSWORD_RECOVERY"),await Br(s,`${e}-code-verifier`,i);const n=await ia(r);return[n,r===n?"plain":"s256"]}const na=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function aa(s){const e=s.headers.get(gs);if(!e||!e.match(na))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function oa(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function la(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ca=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ye(s){if(!ca.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var ua=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(s);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(s,r[i])&&(t[r[i]]=s[r[i]]);return t};const Ue=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),da=[502,503,504];async function nr(s){var e;if(!Xn(s))throw new ms(Ue(s),0);if(da.includes(s.status))throw new ms(Ue(s),s.status);let t;try{t=await s.json()}catch(n){throw new Fr(Ue(n),n)}let r;const i=aa(s);if(i&&i.getTime()>=Lr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new tr(Ue(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ie}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new tr(Ue(t),s.status,t.weak_password.reasons);throw new Dn(Ue(t),s.status||500,r)}const ha=(s,e,t,r)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function M(s,e,t,r){var i;const n=Object.assign({},r==null?void 0:r.headers);n[gs]||(n[gs]=Lr["2024-01-01"].name),r!=null&&r.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const a=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await fa(s,e,t+o,{headers:n,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function fa(s,e,t,r,i,n){const a=ha(e,r,i,n);let o;try{o=await s(t,Object.assign({},a))}catch(c){throw console.error(c),new ms(Ue(c),0)}if(o.ok||await nr(o),r!=null&&r.noResolveJson)return o;try{return await o.json()}catch(c){await nr(c)}}function Ae(s){var e;let t=null;ya(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=Kn(s.expires_in)));const r=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:r},error:null}}function ar(s){const e=Ae(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=s.weak_password),e}function Re(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function ga(s){return{data:s,error:null}}function ma(s){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:n}=s,a=ua(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:n},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function pa(s){return s}function ya(s){return s.access_token&&s.refresh_token&&s.expires_in}const Yt=["global","local","others"];var va=function(s,e){var t={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&e.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(s);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(s,r[i])&&(t[r[i]]=s[r[i]]);return t};class ba{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Ur(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Yt[0]){if(Yt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Yt.join(", ")}`);try{return await M(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(D(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await M(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Re})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=va(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await M(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:ma,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(D(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await M(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Re})}catch(t){if(D(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,n,a,o,c;try{const u={nextPage:null,lastPage:0,total:0},d=await M(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:pa});if(d.error)throw d.error;const f=await d.json(),g=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(c=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(v=>{const b=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(v.split(";")[1].split("=")[1]);u[`${_}Page`]=b}),u.total=parseInt(g)),{data:Object.assign(Object.assign({},f),u),error:null}}catch(u){if(D(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){Ye(e);try{return await M(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Re})}catch(t){if(D(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Ye(e);try{return await M(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Re})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Ye(e);try{return await M(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Re})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Ye(e.userId);try{const{data:t,error:r}=await M(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(D(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Ye(e.userId),Ye(e.id);try{return{data:await M(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}}}const wa={getItem:s=>mt()?globalThis.localStorage.getItem(s):null,setItem:(s,e)=>{mt()&&globalThis.localStorage.setItem(s,e)},removeItem:s=>{mt()&&globalThis.localStorage.removeItem(s)}};function or(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function _a(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Qe={debug:!!(globalThis&&mt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Mr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class xa extends Mr{}async function ja(s,e,t){Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,i.name);try{return await t()}finally{Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,i.name)}}else{if(e===0)throw Qe.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new xa(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(Qe.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}_a();const ka={url:Pn,storageKey:Rn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:$n,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function lr(s,e,t){return await t()}class pt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=pt.nextInstanceID,pt.nextInstanceID+=1,this.instanceID>0&&we()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},ka),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new ba({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Ur(i.fetch),this.lock=i.lock||lr,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:we()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=ja:this.lock=lr,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:mt()?this.storage=wa:(this.memoryStorage={},this.storage=or(this.memoryStorage)):(this.memoryStorage={},this.storage=or(this.memoryStorage)),we()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${$r}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Qn(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),we()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),Mn(n)){const c=(e=n.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:a,redirectType:o}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return D(t)?{error:t}:{error:new Fr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,i;try{const n=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Ae}),{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(n){if(D(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,i;try{let n;if("email"in e){const{email:d,password:f,options:g}=e;let m=null,v=null;this.flowType==="pkce"&&([m,v]=await Ke(this.storage,this.storageKey)),n=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:d,password:f,data:(t=g==null?void 0:g.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:m,code_challenge_method:v},xform:Ae})}else if("phone"in e){const{phone:d,password:f,options:g}=e;n=await M(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:f,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},channel:(i=g==null?void 0:g.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:Ae})}else throw new St("You must provide either an email or phone number and a password");const{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(n){if(D(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:a,options:o}=e;t=await M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ar})}else if("phone"in e){const{phone:n,password:a,options:o}=e;t=await M(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ar})}else throw new St("You must provide either an email or phone number and a password");const{data:r,error:i}=t;return i?{data:{user:null,session:null},error:i}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new kt}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,i,n,a,o,c,u,d,f,g,m;let v,b;if("message"in e)v=e.message,b=e.signature;else{const{chain:_,wallet:N,statement:j,options:k}=e;let $;if(we())if(typeof N=="object")$=N;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))$=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof N!="object"||!(k!=null&&k.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");$=N}const L=new URL((t=k==null?void 0:k.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in $&&$.signIn){const A=await $.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},k==null?void 0:k.signInWithSolana),{version:"1",domain:L.host,uri:L.href}),j?{statement:j}:null));let E;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")E=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)E=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in E&&"signature"in E&&(typeof E.signedMessage=="string"||E.signedMessage instanceof Uint8Array)&&E.signature instanceof Uint8Array)v=typeof E.signedMessage=="string"?E.signedMessage:new TextDecoder().decode(E.signedMessage),b=E.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in $)||typeof $.signMessage!="function"||!("publicKey"in $)||typeof $!="object"||!$.publicKey||!("toBase58"in $.publicKey)||typeof $.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${L.host} wants you to sign in with your Solana account:`,$.publicKey.toBase58(),...j?["",j,""]:[""],"Version: 1",`URI: ${L.href}`,`Issued At: ${(i=(r=k==null?void 0:k.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((n=k==null?void 0:k.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${k.signInWithSolana.notBefore}`]:[],...!((a=k==null?void 0:k.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${k.signInWithSolana.expirationTime}`]:[],...!((o=k==null?void 0:k.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${k.signInWithSolana.chainId}`]:[],...!((c=k==null?void 0:k.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${k.signInWithSolana.nonce}`]:[],...!((u=k==null?void 0:k.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${k.signInWithSolana.requestId}`]:[],...!((f=(d=k==null?void 0:k.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||f===void 0)&&f.length?["Resources",...k.signInWithSolana.resources.map(E=>`- ${E}`)]:[]].join(`
`);const A=await $.signMessage(new TextEncoder().encode(v),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");b=A}}try{const{data:_,error:N}=await M(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:Gn(b)},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Ae});if(N)throw N;return!_||!_.session||!_.user?{data:{user:null,session:null},error:new kt}:(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),{data:Object.assign({},_),error:N})}catch(_){if(D(_))return{data:{user:null,session:null},error:_};throw _}}async _exchangeCodeForSession(e){const t=await Et(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(t??"").split("/");try{const{data:n,error:a}=await M(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Ae});if(await Ct(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new kt}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:a})}catch(n){if(D(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:r,token:i,access_token:n,nonce:a}=e,o=await M(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Ae}),{data:c,error:u}=o;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new kt}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,i,n,a;try{if("email"in e){const{email:o,options:c}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await Ke(this.storage,this.storageKey));const{error:f}=await M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:o,options:c}=e,{data:u,error:d}=await M(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d}}throw new St("You must provide either an email or phone number.")}catch(o){if(D(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await M(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:Ae});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,u=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(D(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,r,i;try{let n=null,a=null;return this.flowType==="pkce"&&([n,a]=await Ke(this.storage,this.storageKey)),await M(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:ga})}catch(n){if(D(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Ie;const{error:i}=await M(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(D(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:n}=e,{error:a}=await M(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:i,options:n}=e,{data:a,error:o}=await M(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new St("You must provide either an email or phone number and a type")}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Et(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Jt:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Re}):await this._useSession(async t=>{var r,i,n;const{data:a,error:o}=t;if(o)throw o;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ie}:await M(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:Re})})}catch(t){if(D(t))return Bn(t)&&(await this._removeSession(),await Ct(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:n}=r;if(n)throw n;if(!i.session)throw new Ie;const a=i.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await Ke(this.storage,this.storageKey));const{data:u,error:d}=await M(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:Re});if(d)throw d;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ie;const t=Date.now()/1e3;let r=t,i=!0,n=null;const{payload:a}=Kt(e.access_token);if(a.exp&&(r=a.exp,i=r<=t),i){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};n=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(D(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Ie;const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!we())throw new At("No browser detected.");if(e.error||e.error_description||e.error_code)throw new At(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new er("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new At("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new er("No code detected.");const{data:j,error:k}=await this._exchangeCodeForSession(e.code);if(k)throw k;const $=new URL(window.location.href);return $.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$.toString()),{data:{session:j.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:n,refresh_token:a,expires_in:o,expires_at:c,token_type:u}=e;if(!n||!o||!a||!u)throw new At("No session defined in URL");const d=Math.round(Date.now()/1e3),f=parseInt(o);let g=d+f;c&&(g=parseInt(c));const m=g-d;m*1e3<=Ze&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${f}s`);const v=g-f;d-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,g,d):d-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,g,d);const{data:b,error:_}=await this._getUser(n);if(_)throw _;const N={provider_token:r,provider_refresh_token:i,access_token:n,expires_in:f,expires_at:g,refresh_token:a,token_type:u,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:N,redirectType:e.type},error:null}}catch(r){if(D(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Et(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:n}=t;if(n)return{error:n};const a=(r=i.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(Un(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Ct(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Yn(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:n},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await Ke(this.storage,this.storageKey,!0));try{return await M(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(D(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(D(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:i}=await this._useSession(async n=>{var a,o,c,u,d;const{data:f,error:g}=n;if(g)throw g;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await M(this.fetch,"GET",m,{headers:this.headers,jwt:(d=(u=f.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return we()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(D(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,i;const{data:n,error:a}=t;if(a)throw a;return await M(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await ea(async i=>(i>0&&await Zn(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await M(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Ae})),(i,n)=>{const a=200*Math.pow(2,i);return n&&Gt(n)&&Date.now()+a-r<Ze})}catch(r){if(this._debug(t,"error",r),D(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),we()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Et(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&await this._removeSession();return}const i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Jt;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Jt}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:n}=await this._callRefreshToken(r.refresh_token);n&&(console.error(n),Gt(n)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",n),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Ie;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Dt;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new Ie;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const o={session:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(i,"error",n),D(n)){const a={session:null,error:n};return Gt(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){n.push(c)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Br(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ct(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&we()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ze);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/Ze);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Ze}ms, refresh threshold is ${fs} ticks`),i<=fs&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Mr)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!we()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const i=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[n,a]=await Ke(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(o.toString())}if(r!=null&&r.queryParams){const n=new URLSearchParams(r.queryParams);i.push(n.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:n}=t;return n?{data:null,error:n}:await M(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:n,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await M(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=n==null?void 0:n.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=c==null?void 0:c.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(D(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:o}=await M(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(D(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:n}=t;return n?{data:null,error:n}:await M(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(D(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],i=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),n=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:i,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Kt(i.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((r=(t=i.user.factors)===null||t===void 0?void 0:t.filter(f=>f.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const d=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(a=>a.kid===e);if(r||(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+Fn>Date.now()))return r;const{data:i,error:n}=await M(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;if(!i.keys||i.keys.length===0)throw new gt("JWKS is empty");if(this.jwks=i,this.jwks_cached_at=Date.now(),r=i.keys.find(a=>a.kid===e),!r)throw new gt("No matching signing key found in JWKS");return r}async getClaims(e,t={keys:[]}){try{let r=e;if(!r){const{data:m,error:v}=await this.getSession();if(v||!m.session)return{data:null,error:v};r=m.session.access_token}const{header:i,payload:n,signature:a,raw:{header:o,payload:c}}=Kt(r);if(oa(n.exp),!i.kid||i.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:m}=await this.getUser(r);if(m)throw m;return{data:{claims:n,header:i,signature:a},error:null}}const u=la(i.alg),d=await this.fetchJwk(i.kid,t),f=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,f,a,Jn(`${o}.${c}`)))throw new gt("Invalid JWT signature");return{data:{claims:n,header:i,signature:a},error:null}}catch(r){if(D(r))return{data:null,error:r};throw r}}}pt.nextInstanceID=0;const Sa=pt;class Aa extends Sa{constructor(e){super(e)}}var Ea=function(s,e,t,r){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(r.next(d))}catch(f){a(f)}}function c(d){try{u(r.throw(d))}catch(f){a(f)}}function u(d){d.done?n(d.value):i(d.value).then(o,c)}u((r=r.apply(s,e||[])).next())})};class Ca{constructor(e,t,r){var i,n,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=Nn(e),c=new URL(o);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const u=`sb-${c.hostname.split(".")[0]}-auth-token`,d={db:jn,realtime:Sn,auth:Object.assign(Object.assign({},kn),{storageKey:u}),global:xn},f=In(r??{},d);this.storageKey=(i=f.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(n=f.global.headers)!==null&&n!==void 0?n:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(g,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=f.auth)!==null&&a!==void 0?a:{},this.headers,f.global.fetch),this.fetch=On(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.rest=new Hi(new URL("rest/v1",c).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),f.accessToken||this._listenForAuthEvents()}get functions(){return new Pi(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new bn(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ea(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,storageKey:n,flowType:a,lock:o,debug:c},u,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Aa({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),u),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,flowType:a,lock:o,debug:c,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new nn(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Vr=(s,e,t)=>new Ca(s,e,t),Oa="https://elspfjgtbjfcirxcynut.supabase.co",Ta="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVsc3Bmamd0YmpmY2lyeGN5bnV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NzIyNTEsImV4cCI6MjA2NDA0ODI1MX0.xS9T9SJWWlFIWgrLkQ09x2IErPDt7CuzAB83qdHKvgA",De=Vr(Oa,Ta),qr=T.createContext(void 0),Na="https://activelegends.github.io/Activelegend",Qt=`${Na}/auth/callback`;function Ia({children:s}){const[e,t]=T.useState(null),[r,i]=T.useState(!1);T.useEffect(()=>{(async()=>{var f;try{const g=window.location.hash,m=window.location.search;console.log("URL Hash:",g),console.log("URL Search:",m);const v=new URLSearchParams(g.substring(1)||m.substring(1)),b=v.get("access_token"),_=v.get("refresh_token"),N=v.get("type");if(console.log("Token Type:",N),console.log("Access Token Present:",!!b),console.log("Refresh Token Present:",!!_),b&&_){console.log("تنظیم سشن با توکن‌های دریافتی");const{data:{session:j},error:k}=await De.auth.setSession({access_token:b,refresh_token:_});if(k)throw console.error("خطا در تنظیم سشن:",k),k;console.log("سشن با موفقیت تنظیم شد:",j),t((j==null?void 0:j.user)??null),i(((f=j==null?void 0:j.user)==null?void 0:f.email)==="active.legendss@gmail.com");const $=window.location.pathname;window.history.replaceState({},document.title,$)}}catch(g){console.error("خطا در مدیریت ریدایرکت:",g)}})(),De.auth.getSession().then(({data:{session:f}})=>{var g;console.log("بررسی سشن اولیه:",f),t((f==null?void 0:f.user)??null),i(((g=f==null?void 0:f.user)==null?void 0:g.email)==="active.legendss@gmail.com")});const{data:{subscription:d}}=De.auth.onAuthStateChange((f,g)=>{var m;console.log("تغییر وضعیت احراز هویت:",f,g),t((g==null?void 0:g.user)??null),i(((m=g==null?void 0:g.user)==null?void 0:m.email)==="active.legendss@gmail.com")});return()=>d.unsubscribe()},[]);const n=async(u,d)=>{const{error:f}=await De.auth.signInWithPassword({email:u,password:d});if(f)throw f},a=async(u,d)=>{const{error:f}=await De.auth.signUp({email:u,password:d,options:{emailRedirectTo:Qt}});if(f)throw f},o=async()=>{const{error:u}=await De.auth.signOut();if(u)throw u},c=async()=>{try{console.log("شروع فرآیند ورود با گوگل"),console.log("Redirect URL:",Qt);const{error:u}=await De.auth.signInWithOAuth({provider:"google",options:{redirectTo:Qt,queryParams:{access_type:"offline",prompt:"consent"}}});if(u)throw console.error("خطا در فراخوانی OAuth:",u),u;console.log("درخواست OAuth با موفقیت ارسال شد")}catch(u){throw console.error("خطا در ورود با گوگل:",u),u instanceof Error?u.message.includes("popup_closed_by_user")?new Error("ورود با گوگل لغو شد"):u.message.includes("popup_blocked")?new Error("پاپ‌آپ مسدود شده است. لطفاً مسدودکننده پاپ‌آپ را غیرفعال کنید"):new Error("خطا در ورود با گوگل. لطفاً دوباره تلاش کنید"):u}};return l.jsx(qr.Provider,{value:{user:e,isAdmin:r,signIn:n,signUp:a,signOut:o,signInWithGoogle:c},children:s})}function nt(){const s=T.useContext(qr);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}var zr={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},cr=B.createContext&&B.createContext(zr),Pa=["attr","size","title"];function Ra(s,e){if(s==null)return{};var t=$a(s,e),r,i;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);for(i=0;i<n.length;i++)r=n[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(s,r)&&(t[r]=s[r])}return t}function $a(s,e){if(s==null)return{};var t={};for(var r in s)if(Object.prototype.hasOwnProperty.call(s,r)){if(e.indexOf(r)>=0)continue;t[r]=s[r]}return t}function It(){return It=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},It.apply(this,arguments)}function ur(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(s);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(s,i).enumerable})),t.push.apply(t,r)}return t}function Pt(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ur(Object(t),!0).forEach(function(r){La(s,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):ur(Object(t)).forEach(function(r){Object.defineProperty(s,r,Object.getOwnPropertyDescriptor(t,r))})}return s}function La(s,e,t){return e=Fa(e),e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Fa(s){var e=Da(s,"string");return typeof e=="symbol"?e:e+""}function Da(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var r=t.call(s,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(s)}function Hr(s){return s&&s.map((e,t)=>B.createElement(e.tag,Pt({key:t},e.attr),Hr(e.child)))}function de(s){return e=>B.createElement(Ua,It({attr:Pt({},s.attr)},e),Hr(s.child))}function Ua(s){var e=t=>{var{attr:r,size:i,title:n}=s,a=Ra(s,Pa),o=i||t.size||"1em",c;return t.className&&(c=t.className),s.className&&(c=(c?c+" ":"")+s.className),B.createElement("svg",It({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,a,{className:c,style:Pt(Pt({color:s.color||t.color},t.style),s.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),n&&B.createElement("title",null,n),s.children)};return cr!==void 0?B.createElement(cr.Consumer,null,t=>e(t)):e(zr)}function Ba(s){return de({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"},child:[]}]})(s)}function Ma(s){return de({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"},child:[]}]})(s)}function Va(s){return de({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z",clipRule:"evenodd"},child:[]}]})(s)}function qa(s){return de({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"},child:[]}]})(s)}function za(s){return de({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"},child:[]}]})(s)}function Ha(s){return de({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"},child:[]}]})(s)}function Wa(s){return de({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"},child:[]}]})(s)}function Ja(){var r;const{user:s,isAdmin:e,signOut:t}=nt();return s?l.jsxs(Te,{as:"div",className:"relative inline-block text-right",children:[l.jsx(Te.Button,{className:"inline-flex items-center justify-center rounded-full w-10 h-10 bg-white/10 text-white hover:bg-white/20 transition-colors",children:(r=s.user_metadata)!=null&&r.avatar_url?l.jsx("img",{src:s.user_metadata.avatar_url,alt:"User avatar",className:"w-full h-full rounded-full object-cover"}):l.jsx(Wa,{className:"w-5 h-5"})}),l.jsx(fi,{as:T.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:l.jsx(Te.Items,{className:"absolute left-0 mt-2 w-56 origin-top-left rounded-md bg-black border border-white/10 shadow-lg focus:outline-none",children:l.jsxs("div",{className:"p-2",children:[l.jsxs("div",{className:"px-3 py-2 text-sm text-gray-300",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},children:[s.email,e&&l.jsx("span",{className:"mr-2 text-xs bg-primary/20 text-primary px-2 py-0.5 rounded",children:"مدیر"})]}),e&&l.jsxs(l.Fragment,{children:[l.jsx(Te.Item,{children:({active:i})=>l.jsxs("button",{className:`${i?"bg-white/10":""} group flex w-full items-center rounded-md px-3 py-2 text-sm text-white gap-2`,children:[l.jsx(Ha,{className:"w-5 h-5"}),"مدیریت کاربران"]})}),l.jsx(Te.Item,{children:({active:i})=>l.jsxs("button",{className:`${i?"bg-white/10":""} group flex w-full items-center rounded-md px-3 py-2 text-sm text-white gap-2`,children:[l.jsx(qa,{className:"w-5 h-5"}),"مدیریت نظرات"]})}),l.jsx(Te.Item,{children:({active:i})=>l.jsxs("button",{className:`${i?"bg-white/10":""} group flex w-full items-center rounded-md px-3 py-2 text-sm text-white gap-2`,children:[l.jsx(za,{className:"w-5 h-5"}),"حذف محتوا"]})}),l.jsx("div",{className:"my-1 border-t border-white/10"})]}),l.jsx(Te.Item,{children:({active:i})=>l.jsxs(ye,{to:"/my-games",className:`${i?"bg-white/10":""} group flex w-full items-center rounded-md px-3 py-2 text-sm text-white gap-2`,children:[l.jsx(Ma,{className:"w-5 h-5"}),"موارد دلخواه"]})}),l.jsx(Te.Item,{children:({active:i})=>l.jsxs("button",{onClick:()=>t(),className:`${i?"bg-white/10":""} group flex w-full items-center rounded-md px-3 py-2 text-sm text-white gap-2`,children:[l.jsx(Va,{className:"w-5 h-5"}),"خروج"]})})]})})})]}):null}function Ga(s){return de({attr:{version:"1.1",x:"0px",y:"0px",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"path",attr:{fill:"#FFC107",d:`M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\r
	c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24\r
	c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z`},child:[]},{tag:"path",attr:{fill:"#FF3D00",d:`M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657\r
	C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z`},child:[]},{tag:"path",attr:{fill:"#4CAF50",d:`M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\r
	c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z`},child:[]},{tag:"path",attr:{fill:"#1976D2",d:`M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\r
	c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z`},child:[]}]})(s)}function Wr({isOpen:s,onClose:e,initialMode:t="login"}){const[r,i]=T.useState(t==="login"),[n,a]=T.useState(""),[o,c]=T.useState(""),[u,d]=T.useState(""),{signIn:f,signUp:g,signInWithGoogle:m}=nt();T.useEffect(()=>{i(t==="login")},[t]);const v=j=>{j instanceof Error?j.message.includes("over_email_send_rate_limit")?d("تعداد درخواست‌ها زیاد است. لطفاً کمی صبر کنید و دوباره تلاش کنید."):j.message.includes("invalid_credentials")?d("ایمیل یا رمز عبور اشتباه است."):j.message.includes("Email not confirmed")?d("لطفاً ایمیل خود را تایید کنید."):d("خطایی رخ داد. لطفاً دوباره تلاش کنید."):d("خطایی رخ داد")},b=()=>!n||!o?(d("لطفاً تمام فیلدها را پر کنید."),!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?o.length<6?(d("رمز عبور باید حداقل ۶ کاراکتر باشد."),!1):!0:(d("لطفاً یک ایمیل معتبر وارد کنید."),!1),_=async j=>{if(j.preventDefault(),d(""),!!b())try{r?await f(n,o):await g(n,o),e()}catch(k){v(k)}},N=async()=>{try{await m(),e()}catch(j){v(j)}};return l.jsx(Ft,{children:s&&l.jsxs(zt,{as:F.div,static:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},open:s,onClose:e,className:"relative z-50",children:[l.jsx("div",{className:"fixed inset-0 bg-black/70","aria-hidden":"true"}),l.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:l.jsxs(zt.Panel,{as:F.div,initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"w-full max-w-md overflow-hidden rounded-2xl bg-black p-6 text-right shadow-xl border border-white/10",children:[l.jsx(zt.Title,{className:"text-2xl font-bold text-white mb-4",children:r?"ورود به حساب کاربری":"ثبت‌نام"}),l.jsxs("form",{onSubmit:_,className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"ایمیل"}),l.jsx("input",{type:"email",value:n,onChange:j=>a(j.target.value),className:"mt-1 block w-full rounded-lg bg-white/5 border border-white/10 px-3 py-2 text-white focus:border-primary focus:ring-primary",dir:"ltr",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"رمز عبور"}),l.jsx("input",{type:"password",value:o,onChange:j=>c(j.target.value),className:"mt-1 block w-full rounded-lg bg-white/5 border border-white/10 px-3 py-2 text-white focus:border-primary focus:ring-primary",dir:"ltr",required:!0,minLength:6})]}),u&&l.jsx("p",{className:"text-red-500 text-sm",children:u}),l.jsx("button",{type:"submit",className:"w-full btn-primary",children:r?"ورود":"ثبت‌نام"}),l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-0 flex items-center",children:l.jsx("div",{className:"w-full border-t border-white/10"})}),l.jsx("div",{className:"relative flex justify-center text-sm",children:l.jsx("span",{className:"px-2 text-gray-500 bg-black",children:"یا"})})]}),l.jsxs("button",{type:"button",onClick:N,className:"w-full btn-secondary flex items-center justify-center gap-2",children:[l.jsx(Ga,{className:"w-5 h-5"}),l.jsx("span",{children:"ورود با گوگل"})]}),l.jsx("button",{type:"button",onClick:()=>i(!r),className:"w-full text-sm text-gray-400 hover:text-white",children:r?"حساب کاربری ندارید؟ ثبت‌نام کنید":"قبلاً ثبت‌نام کرده‌اید؟ وارد شوید"})]})]})})]})})}function Ka(){const[s,e]=T.useState(!1),[t,r]=T.useState(!1),[i,n]=T.useState("login"),{user:a}=nt(),o=wi(),c=bs();T.useEffect(()=>{const m=()=>{e(window.scrollY>50)};return window.addEventListener("scroll",m),()=>window.removeEventListener("scroll",m)},[]);const u=m=>{n(m),r(!0)},d=m=>{if(m.preventDefault(),o.pathname!=="/")c("/"),setTimeout(()=>{const v=document.getElementById("gallery");if(v){const N=v.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:N,behavior:"smooth"})}},100);else{const v=document.getElementById("gallery");if(v){const N=v.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:N,behavior:"smooth"})}}},f=(m,v)=>{if(m.preventDefault(),o.pathname!=="/")c("/"),setTimeout(()=>{const b=document.getElementById(v);if(b){const j=b.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:j,behavior:"smooth"})}},100);else{const b=document.getElementById(v);if(b){const j=b.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:j,behavior:"smooth"})}}},g=()=>o.pathname==="/"?l.jsxs(l.Fragment,{children:[l.jsx("a",{href:"#about",onClick:m=>f(m,"about"),className:"nav-link",children:"درباره ما"}),l.jsx(ye,{to:"/games",className:"nav-link",children:"بازی‌ها"}),a&&l.jsx(ye,{to:"/my-games",className:"nav-link",children:"موارد دلخواه"}),l.jsx("a",{href:"#gallery",onClick:d,className:"nav-link",children:"ویترین"}),l.jsx("a",{href:"#contact",onClick:m=>f(m,"contact"),className:"nav-link",children:"تماس"})]}):o.pathname.startsWith("/games")?l.jsxs(l.Fragment,{children:[l.jsx(ye,{to:"/",className:"nav-link",children:"صفحه اصلی"}),l.jsx(ye,{to:"/games",className:"nav-link",children:"بازی‌ها"}),a&&l.jsx(ye,{to:"/my-games",className:"nav-link",children:"موارد دلخواه"}),l.jsx("a",{href:"#gallery",onClick:d,className:"nav-link",children:"ویترین"}),l.jsx("a",{href:"#contact",onClick:m=>f(m,"contact"),className:"nav-link",children:"تماس"})]}):l.jsxs(l.Fragment,{children:[l.jsx(ye,{to:"/",className:"nav-link",children:"صفحه اصلی"}),l.jsx(ye,{to:"/games",className:"nav-link",children:"بازی‌ها"}),a&&l.jsx(ye,{to:"/my-games",className:"nav-link",children:"موارد دلخواه"}),l.jsx("a",{href:"#gallery",onClick:d,className:"nav-link",children:"ویترین"}),l.jsx("a",{href:"#contact",onClick:m=>f(m,"contact"),className:"nav-link",children:"تماس"})]});return l.jsxs(l.Fragment,{children:[l.jsx(F.nav,{initial:{y:-100},animate:{y:0},className:`fixed top-0 right-0 left-0 z-50 transition-all duration-300 ${s?"backdrop-blur-md bg-black/50 py-4":"py-6"}`,style:{willChange:"transform",transform:"translateZ(0)",backfaceVisibility:"hidden",perspective:"1000px"},children:l.jsxs("div",{className:"container mx-auto px-4 flex items-center justify-between",children:[l.jsx(ye,{to:"/",children:l.jsx(F.img,{src:"/AE-logo.png",alt:"Active Legends",className:"h-8 w-auto",whileHover:{scale:1.05}})}),l.jsxs("div",{className:"flex items-center gap-8",children:[g(),a?l.jsx(Ja,{}):l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx(F.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"btn-secondary",onClick:()=>u("login"),children:"ورود"}),l.jsx(F.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"btn-primary",onClick:()=>u("signup"),children:"ثبت‌نام"})]})]})]})}),l.jsx(Wr,{isOpen:t,onClose:()=>r(!1),initialMode:i})]})}function Ya(){return l.jsx(F.div,{className:"absolute bottom-8 left-1/2 -translate-x-1/2 text-white/80",initial:{opacity:0,y:-10},animate:{opacity:[.5,1,.5],y:[0,10,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:l.jsx(Ba,{className:"w-8 h-8"})})}function Qa(){const[s,e]=T.useState(!1),[t,r]=T.useState("login"),{user:i}=nt(),n=c=>{r(c),e(!0)},a=window.innerWidth<640,o={initial:{opacity:0,y:a?10:20},animate:{opacity:1,y:0},transition:{duration:a?.5:.8}};return l.jsxs("header",{className:"relative min-h-screen flex items-center justify-center overflow-hidden scroll-container",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/50 via-black/80 to-black/95"}),l.jsxs(F.div,{...o,className:"relative z-10 text-center max-w-4xl mx-auto px-4",style:{willChange:"transform",transform:"translateZ(0)",backfaceVisibility:"hidden",perspective:"1000px"},children:[l.jsx(F.img,{src:"/AE-logo.png",alt:"Active Legends",className:"w-40 h-40 sm:w-64 sm:h-64 md:w-80 md:h-80 mx-auto mb-8",initial:{scale:a?.8:0},animate:{scale:1},transition:{type:a?"tween":"spring",duration:a?.5:1}}),l.jsx(F.h1,{className:"text-5xl md:text-6xl font-bold mb-4 text-white bg-clip-text",...o,transition:{...o.transition,delay:a?.1:.3},children:"به دنیای اکتیو لجندز خوش آمدید"}),l.jsx(F.p,{className:"text-xl md:text-2xl mb-8 text-gray-300",...o,transition:{...o.transition,delay:a?.2:.5},children:"توسعه‌دهنده بازی‌های موبایل و کامپیوتر"}),l.jsxs(F.div,{className:"space-x-4 space-x-reverse",...o,transition:{...o.transition,delay:a?.3:.7},children:[l.jsx(ye,{to:"/games",children:l.jsx(F.button,{className:"btn-primary",whileHover:{scale:a?1.02:1.05},whileTap:{scale:a?.98:.95},children:"مشاهده بازی‌ها"})}),!i&&l.jsxs(l.Fragment,{children:[l.jsx(F.button,{className:"btn-secondary",whileHover:{scale:a?1.02:1.05},whileTap:{scale:a?.98:.95},onClick:()=>n("signup"),children:"ثبت‌نام"}),l.jsx(F.button,{className:"btn-secondary",whileHover:{scale:a?1.02:1.05},whileTap:{scale:a?.98:.95},onClick:()=>n("login"),children:"ورود"})]})]})]}),l.jsx(Ya,{}),l.jsx(Wr,{isOpen:s,onClose:()=>e(!1),initialMode:t})]})}const dr=["#FACC15","#FBBF24","#F59E0B","#D97706","#B45309"];function Xa(s){return Array.from({length:s}).map(()=>({id:crypto.randomUUID(),size:200+Math.random()*250,x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,color:dr[Math.floor(Math.random()*dr.length)],parallax:15+Math.random()*20,rotation:Math.random()*360,scale:1+Math.random()*.5}))}function Za(){const[e,t]=T.useState(()=>Xa(5));T.useRef({x:window.innerWidth/2,y:window.innerHeight/2});const[r,i]=T.useState(e.map(()=>({x:0,y:0})));return T.useEffect(()=>{const n=a=>{const o=a.clientX,c=a.clientY,u=e.map(d=>{const f=(o-window.innerWidth/2)/d.parallax,g=(c-window.innerHeight/2)/d.parallax;return{x:-f,y:-g}});i(u)};return window.addEventListener("mousemove",n),()=>window.removeEventListener("mousemove",n)},[e]),T.useEffect(()=>{const n=setInterval(()=>{t(a=>a.map(o=>({...o,rotation:(o.rotation+2)%360,scale:1+Math.sin(Date.now()/500+o.id.charCodeAt(0))*.3})))},30);return()=>clearInterval(n)},[]),l.jsxs("div",{className:"fixed inset-0 z-0 overflow-hidden bg-gradient-to-br from-amber-950 via-orange-950 to-amber-950 pointer-events-none",children:[e.map((n,a)=>{var o,c;return l.jsx(F.div,{className:"absolute rounded-full pointer-events-none",style:{width:n.size,height:n.size,backgroundColor:n.color,top:0,left:0,opacity:.5,filter:"blur(25px)",mixBlendMode:"screen"},animate:{x:n.x+((o=r[a])==null?void 0:o.x),y:n.y+((c=r[a])==null?void 0:c.y),rotate:n.rotation,scale:n.scale},transition:{duration:.2,ease:"linear"}},n.id)}),l.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-amber-500/20 to-transparent animate-pulse"})]})}function eo(s){return de({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"},child:[]}]})(s)}function to(s){return de({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(s)}function so(s){return de({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(s)}function ro(s){return de({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"},child:[]}]})(s)}function hr(s){return de({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(s)}function io(s){return de({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(s)}function no(s){return de({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"},child:[]}]})(s)}const{createClient:ao}=window.supabase,oo="https://elspfjgtbjfcirxcynut.supabase.co",lo="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVsc3Bmamd0YmpmY2lyeGN5bnV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NzIyNTEsImV4cCI6MjA2NDA0ODI1MX0.xS9T9SJWWlFIWgrLkQ09x2IErPDt7CuzAB83qdHKvgA",ct=ao(oo,lo);B.memo(({onSubmit:s,onClose:e,initialData:t,isEditing:r})=>{const[i,n]=T.useState(t||{type:"image",url:"",title:"",description:""}),a=o=>{o.preventDefault(),s(i)};return l.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:l.jsxs("div",{className:"bg-gray-900 rounded-lg p-6 max-w-md w-full shadow-2xl border border-gray-700",children:[l.jsx("h3",{className:"text-2xl font-bold mb-6 text-white text-center",children:r?"ویرایش رسانه":"افزودن رسانه جدید"}),l.jsxs("form",{onSubmit:a,className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-gray-300 mb-2 text-right",children:"نوع رسانه"}),l.jsxs("select",{value:i.type,onChange:o=>n(c=>({...c,type:o.target.value})),className:"w-full bg-gray-800 text-white rounded p-3 border border-gray-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 transition-all duration-200",children:[l.jsx("option",{value:"image",children:"تصویر"}),l.jsx("option",{value:"video",children:"ویدیو"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-gray-300 mb-2 text-right",children:"آدرس"}),l.jsx("input",{type:"text",value:i.url,onChange:o=>n(c=>({...c,url:o.target.value})),className:"w-full bg-gray-800 text-white rounded p-3 border border-gray-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 transition-all duration-200",placeholder:i.type==="image"?"آدرس تصویر":"آدرس ویدیو (YouTube یا Vimeo)",dir:"ltr",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-gray-300 mb-2 text-right",children:"عنوان"}),l.jsx("input",{type:"text",value:i.title,onChange:o=>n(c=>({...c,title:o.target.value})),className:"w-full bg-gray-800 text-white rounded p-3 border border-gray-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 transition-all duration-200",placeholder:"عنوان به فارسی",dir:"rtl",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-gray-300 mb-2 text-right",children:"توضیحات"}),l.jsx("textarea",{value:i.description,onChange:o=>n(c=>({...c,description:o.target.value})),className:"w-full bg-gray-800 text-white rounded p-3 border border-gray-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 transition-all duration-200 resize-none",rows:3,placeholder:"توضیحات به فارسی",dir:"rtl",required:!0})]}),l.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[l.jsx("button",{type:"button",onClick:e,className:"px-6 py-3 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors duration-200",children:"انصراف"}),l.jsx("button",{type:"submit",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-colors duration-200",children:r?"ویرایش":"افزودن"})]})]})]})})});function co(){const{user:s}=nt(),[e,t]=T.useState([]),[r,i]=T.useState(!1),[n,a]=T.useState(null),[o,c]=T.useState(null),[u,d]=T.useState(new Set),[f,g]=T.useState({}),m=gi(),v=T.useRef({}),b=T.useRef(null),_=mi(b,{once:!0,margin:"-100px"}),[N,j]=T.useState({type:"image",url:"",title:"",description:""}),k=(s==null?void 0:s.email)==="active.legendss@gmail.com",$=async w=>{var P;try{const R=(P=w.split("/").pop())==null?void 0:P.split("?")[0];if(!R)return null;const he=await(await fetch(`https://www.aparat.com/etc/api/video/videohash/${R}`)).json();return he.video?{uid:he.video.uid,title:he.video.title,small_poster:he.video.small_poster,big_poster:he.video.big_poster}:null}catch(R){return console.error("Error fetching Aparat video info:",R),null}};T.useEffect(()=>{L()},[]);const L=async()=>{try{const{data:w,error:P}=await ct.from("media_gallery").select("*").order("created_at",{ascending:!1});if(P)throw P;w&&(console.log("Fetched media items:",w),t(w),w.forEach(async R=>{if(R.type==="video"&&R.url.includes("aparat.com")){const ee=await $(R.url);ee&&g(he=>({...he,[R.id]:ee}))}}))}catch(w){console.error("Error fetching media items:",w),alert("خطا در دریافت اطلاعات. لطفاً صفحه را رفرش کنید.")}};T.useEffect(()=>{_&&m.start("visible")},[_,m]);const A=w=>{const P=v.current[w];P&&(u.has(w)?(P.pause(),d(R=>{const ee=new Set(R);return ee.delete(w),ee})):(u.forEach(R=>{const ee=v.current[R];ee&&ee.pause()}),d(new Set([w])),P.play().catch(R=>{console.error("Error playing video:",R)})))},E=()=>{j({type:"image",url:"",title:"",description:""}),a(null),i(!0)},U=()=>{i(!1),a(null),j({type:"image",url:"",title:"",description:""})},V=w=>{j({type:w.type,url:w.url,title:w.title,description:w.description}),a(w),i(!0)},ae=async w=>{w.preventDefault(),console.log("Form submitted:",N);try{if(n){console.log("Updating item:",n.id);const{data:P,error:R}=await ct.from("media_gallery").update({type:N.type,url:N.url,title:N.title,description:N.description,updated_at:new Date().toISOString()}).eq("id",n.id).select();if(R)throw console.error("Update error:",R),R;console.log("Update successful:",P)}else{console.log("Inserting new item");const{data:P,error:R}=await ct.from("media_gallery").insert([{type:N.type,url:N.url,title:N.title,description:N.description,is_visible:!0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}]).select();if(R)throw console.error("Insert error:",R),R;console.log("Insert successful:",P)}U(),await L()}catch(P){console.error("Error saving media item:",P),alert("خطا در ذخیره اطلاعات. لطفاً دوباره تلاش کنید.")}},te=(w,P)=>{j(R=>({...R,[w]:P}))},q=async w=>{if(confirm("آیا از حذف این رسانه اطمینان دارید؟"))try{console.log("Deleting media with ID:",w);const{data:P,error:R}=await ct.from("media_gallery").delete().eq("id",w).select();if(R)throw console.error("Supabase delete error:",R),R;console.log("Delete response:",P),await L()}catch(P){console.error("Error in handleDelete:",P),alert("خطا در حذف رسانه. لطفاً دوباره تلاش کنید.")}},z=async(w,P)=>{if(!w){console.error("Media ID is undefined");return}try{console.log("Toggling visibility for ID:",w,"Current visibility:",P);const{data:R,error:ee}=await ct.from("media_gallery").update({is_visible:!P}).eq("id",w).select();if(ee)throw console.error("Supabase update error:",ee),ee;console.log("Update response:",R),await L()}catch(R){console.error("Error in handleToggleVisibility:",R),alert("خطا در تغییر وضعیت نمایش. لطفاً دوباره تلاش کنید.")}},Y=w=>{var P;try{if(w.includes("youtube.com")||w.includes("youtu.be"))return`https://www.youtube.com/embed/${w.includes("youtu.be")?w.split("/").pop():new URL(w).searchParams.get("v")}`;if(w.includes("vimeo.com"))return`https://player.vimeo.com/video/${w.split("/").pop()}`;if(w.includes("aparat.com")){const R=(P=w.split("/").pop())==null?void 0:P.split("?")[0];if(R)return`https://www.aparat.com/video/video/embed/videohash/${R}/vt/frame`}return w}catch(R){return console.error("Error parsing video URL:",R),w}},ie=w=>{try{if(w.includes("onedrive.live.com")||w.includes("1drv.ms")){const P=w.replace("redir?","download?");return P.includes("?")?`${P}&download=1`:`${P}?download=1`}if(w.includes("drive.google.com")){let P="";if(w.includes("/d/"))P=w.split("/d/")[1].split("/")[0];else if(w.includes("id="))P=w.split("id=")[1].split("&")[0];else{const R=w.match(/[-\w]{25,}/);R&&(P=R[0])}if(P)return`https://drive.google.com/thumbnail?id=${P}&sz=w1000`}return w}catch(P){return console.error("Error parsing image URL:",P),w}},ne=w=>{var ee;const P=w.target,R=P.src;if(R.includes("drive.google.com")){const he=(ee=R.split("id=")[1])==null?void 0:ee.split("&")[0];if(he){P.src=`https://drive.google.com/uc?export=view&id=${he}`;return}}if(R.includes("onedrive.live.com")||R.includes("1drv.ms")){const he=R.replace("download?","redir?");P.src=he;return}P.src="/AE-logo.png"},me=k?e:e.filter(w=>w.is_visible),Ce={hidden:{opacity:0,y:100},visible:{opacity:1,y:0,transition:{duration:.8,ease:"easeOut",staggerChildren:.2}}},be={hidden:{opacity:0,y:50},visible:{opacity:1,y:0,transition:{duration:.5,ease:"easeOut"}}};return l.jsxs(F.section,{ref:b,variants:Ce,initial:"hidden",animate:m,id:"gallery",className:"py-12 sm:py-16 md:py-20 px-4 md:px-8 lg:px-12 bg-gray-950 relative overflow-hidden min-h-screen scroll-container",children:[l.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/50 via-black/80 to-black/95"}),l.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-blue-500/10 via-transparent to-transparent animate-pulse"}),l.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-purple-500/10 via-transparent to-transparent animate-pulse",style:{animationDelay:"1s"}}),l.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-pink-500/10 via-transparent to-transparent animate-pulse",style:{animationDelay:"2s"}})]}),l.jsxs("div",{className:"container mx-auto px-4 relative z-10",children:[l.jsx(F.h2,{variants:be,className:"text-4xl sm:text-5xl md:text-6xl font-bold text-white mb-10 sm:mb-14 text-center",children:"گالری رسانه‌ها"}),k&&l.jsx(F.div,{variants:be,className:"flex justify-end mb-8 sm:mb-10",children:l.jsxs(F.button,{whileHover:{scale:1.05,boxShadow:"0 0 20px rgba(59, 130, 246, 0.5)"},whileTap:{scale:.95},onClick:E,className:"flex items-center gap-3 px-6 sm:px-8 py-3 sm:py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-all duration-200 text-base sm:text-lg",children:[l.jsx(io,{className:"text-lg sm:text-xl"})," افزودن رسانه جدید"]})}),me.length===0?l.jsx(F.div,{variants:be,className:"text-center text-gray-400 py-12 text-xl sm:text-2xl",children:k?"هیچ رسانه‌ای وجود ندارد":"در حال حاضر هیچ رسانه‌ای برای نمایش وجود ندارد"}):l.jsx(F.div,{variants:Ce,className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8 lg:gap-10 scroll-container",style:{willChange:"transform",transform:"translateZ(0)",backfaceVisibility:"hidden",perspective:"1000px"},children:l.jsx(Ft,{mode:"sync",children:me.map(w=>l.jsxs(F.div,{variants:be,initial:"hidden",animate:"visible",exit:"hidden",whileHover:{scale:1.02,boxShadow:"0 0 30px rgba(59, 130, 246, 0.2)"},onHoverStart:()=>c(w.id),onHoverEnd:()=>c(null),className:"bg-gray-800/50 backdrop-blur-sm rounded-xl overflow-hidden shadow-lg transform transition-all duration-300 border border-gray-700/50 hover:border-blue-500/50",children:[l.jsx("div",{className:"relative aspect-video group",children:w.type==="image"?l.jsx(F.img,{src:ie(w.url),alt:w.title,className:"w-full h-full object-cover",whileHover:{scale:1.1},transition:{duration:.3},onError:ne,loading:"lazy"}):l.jsx("div",{className:"relative w-full h-full",children:w.url.includes("youtube.com")||w.url.includes("youtu.be")||w.url.includes("vimeo.com")||w.url.includes("aparat.com")?l.jsx(l.Fragment,{children:w.url.includes("aparat.com")&&f[w.id]?l.jsxs("div",{className:"relative w-full h-full",children:[l.jsx("img",{src:f[w.id].big_poster,alt:f[w.id].title,className:"w-full h-full object-cover"}),l.jsx(F.button,{initial:{opacity:0},animate:{opacity:o===w.id?1:0},onClick:()=>window.open(w.url,"_blank"),className:"absolute inset-0 flex items-center justify-center bg-black/50 text-white text-5xl hover:bg-black/60 transition-colors duration-200 backdrop-blur-sm",children:l.jsx(hr,{className:"transform hover:scale-110 transition-transform duration-200"})})]}):l.jsx("iframe",{src:Y(w.url),className:"w-full h-full",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",frameBorder:"0",loading:"lazy"})}):l.jsxs(l.Fragment,{children:[l.jsx("video",{ref:P=>v.current[w.id]=P,src:w.url,className:"w-full h-full object-cover",loop:!0,muted:!0,playsInline:!0,onLoadedData:()=>{const P=v.current[w.id];P&&(P.currentTime=0)}}),l.jsx(F.button,{initial:{opacity:0},animate:{opacity:o===w.id?1:0},onClick:()=>A(w.id),className:"absolute inset-0 flex items-center justify-center bg-black/50 text-white text-5xl hover:bg-black/60 transition-colors duration-200 backdrop-blur-sm",children:u.has(w.id)?l.jsx(ro,{className:"transform hover:scale-110 transition-transform duration-200"}):l.jsx(hr,{className:"transform hover:scale-110 transition-transform duration-200"})})]})})}),l.jsxs("div",{className:"p-6 sm:p-8",children:[l.jsx(F.h3,{initial:{opacity:0},animate:{opacity:1},className:"text-2xl sm:text-3xl font-bold text-white mb-3 sm:mb-4",children:w.title}),l.jsx(F.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-gray-300 leading-relaxed text-base sm:text-lg",children:w.description})]}),k&&l.jsxs(F.div,{initial:{opacity:0},animate:{opacity:1},className:"p-4 sm:p-6 border-t border-gray-700/50 flex justify-end gap-3 sm:gap-4 bg-gray-900/50 backdrop-blur-sm",children:[l.jsx(F.button,{whileHover:{scale:1.1,color:"#60A5FA"},whileTap:{scale:.9},onClick:()=>V(w),className:"p-2 sm:p-3 text-blue-400 hover:text-blue-300 transition-colors duration-200",children:l.jsx(eo,{className:"text-xl sm:text-2xl"})}),l.jsx(F.button,{whileHover:{scale:1.1,color:"#FCD34D"},whileTap:{scale:.9},onClick:()=>z(w.id,w.is_visible),className:"p-2 sm:p-3 text-yellow-400 hover:text-yellow-300 transition-colors duration-200",children:w.is_visible?l.jsx(to,{className:"text-xl sm:text-2xl"}):l.jsx(so,{className:"text-xl sm:text-2xl"})}),l.jsx(F.button,{whileHover:{scale:1.1,color:"#F87171"},whileTap:{scale:.9},onClick:()=>q(w.id),className:"p-2 sm:p-3 text-red-400 hover:text-red-300 transition-colors duration-200",children:l.jsx(no,{className:"text-xl sm:text-2xl"})})]})]},w.id))})})]}),r&&l.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:l.jsxs(F.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-gray-900 rounded-xl p-6 sm:p-8 max-w-lg w-full shadow-2xl border border-gray-700",children:[l.jsx("h3",{className:"text-2xl sm:text-3xl font-bold mb-8 text-white text-center",children:n?"ویرایش رسانه":"افزودن رسانه جدید"}),l.jsxs("form",{onSubmit:ae,className:"space-y-6",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-gray-300 mb-3 text-right text-base sm:text-lg",children:"نوع رسانه"}),l.jsxs("select",{value:N.type,onChange:w=>te("type",w.target.value),className:"w-full bg-gray-800 text-white rounded-lg p-3 sm:p-4 border border-gray-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 transition-all duration-200 text-base sm:text-lg",children:[l.jsx("option",{value:"image",children:"تصویر"}),l.jsx("option",{value:"video",children:"ویدیو"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-gray-300 mb-3 text-right text-base sm:text-lg",children:"آدرس"}),l.jsx("input",{type:"text",value:N.url,onChange:w=>te("url",w.target.value),className:"w-full bg-gray-800 text-white rounded-lg p-3 sm:p-4 border border-gray-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 transition-all duration-200 text-base sm:text-lg",placeholder:N.type==="image"?"آدرس تصویر":"آدرس ویدیو (YouTube یا Vimeo)",dir:"ltr",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-gray-300 mb-3 text-right text-base sm:text-lg",children:"عنوان"}),l.jsx("input",{type:"text",value:N.title,onChange:w=>te("title",w.target.value),className:"w-full bg-gray-800 text-white rounded-lg p-3 sm:p-4 border border-gray-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 transition-all duration-200 text-base sm:text-lg",placeholder:"عنوان به فارسی",dir:"rtl",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-gray-300 mb-3 text-right text-base sm:text-lg",children:"توضیحات"}),l.jsx("textarea",{value:N.description,onChange:w=>te("description",w.target.value),className:"w-full bg-gray-800 text-white rounded-lg p-3 sm:p-4 border border-gray-700 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 transition-all duration-200 resize-none text-base sm:text-lg",rows:4,placeholder:"توضیحات به فارسی",dir:"rtl",required:!0})]}),l.jsxs("div",{className:"flex justify-end gap-4 mt-8",children:[l.jsx("button",{type:"button",onClick:U,className:"px-6 sm:px-8 py-3 sm:py-4 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors duration-200 text-base sm:text-lg",children:"انصراف"}),l.jsx("button",{type:"submit",className:"px-6 sm:px-8 py-3 sm:py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-500 transition-colors duration-200 text-base sm:text-lg",children:n?"ویرایش":"افزودن"})]})]})]})})]})}const uo="https://elspfjgtbjfcirxcynut.supabase.co",ho="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVsc3Bmamd0YmpmY2lyeGN5bnV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0NzIyNTEsImV4cCI6MjA2NDA0ODI1MX0.xS9T9SJWWlFIWgrLkQ09x2IErPDt7CuzAB83qdHKvgA",ue=Vr(uo,ho),fo=({status:s})=>{const e=i=>{switch(i){case"in_progress":return{text:"در حال ساخت",bgColor:"bg-yellow-500"};case"released":return{text:"ساخته شده",bgColor:"bg-green-500"};case"coming_soon":return{text:"به زودی",bgColor:"bg-blue-500"};default:return{text:"",bgColor:""}}},{text:t,bgColor:r}=e(s);return t?l.jsx("span",{className:`absolute top-4 left-4 ${r} text-xs font-bold text-white px-2 py-1 rounded-full`,children:t}):null},Jr=({game:s})=>l.jsxs("div",{className:"relative",children:[l.jsx(fo,{status:s.status}),l.jsx(F.div,{whileHover:{scale:1.03,boxShadow:"0 10px 20px rgba(0,0,0,0.3)"},transition:{type:"spring",stiffness:300},children:l.jsx(ye,{to:`/games/${s.slug}`,children:l.jsx("img",{src:s.image_icon,alt:s.title,className:"rounded-2xl w-full h-auto object-cover"})})})]});var bt=s=>s.type==="checkbox",Me=s=>s instanceof Date,ce=s=>s==null;const Gr=s=>typeof s=="object";var X=s=>!ce(s)&&!Array.isArray(s)&&Gr(s)&&!Me(s),go=s=>X(s)&&s.target?bt(s.target)?s.target.checked:s.target.value:s,mo=s=>s.substring(0,s.search(/\.\d+(\.|$)/))||s,po=(s,e)=>s.has(mo(e)),yo=s=>{const e=s.constructor&&s.constructor.prototype;return X(e)&&e.hasOwnProperty("isPrototypeOf")},Ss=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Q(s){let e;const t=Array.isArray(s),r=typeof FileList<"u"?s instanceof FileList:!1;if(s instanceof Date)e=new Date(s);else if(s instanceof Set)e=new Set(s);else if(!(Ss&&(s instanceof Blob||r))&&(t||X(s)))if(e=t?[]:{},!t&&!yo(s))e=s;else for(const i in s)s.hasOwnProperty(i)&&(e[i]=Q(s[i]));else return s;return e}var wt=s=>Array.isArray(s)?s.filter(Boolean):[],K=s=>s===void 0,O=(s,e,t)=>{if(!e||!X(s))return t;const r=wt(e.split(/[,[\].]+?/)).reduce((i,n)=>ce(i)?i:i[n],s);return K(r)||r===s?K(s[e])?t:s[e]:r},je=s=>typeof s=="boolean",As=s=>/^\w*$/.test(s),Kr=s=>wt(s.replace(/["|']|\]/g,"").split(/\.|\[/)),W=(s,e,t)=>{let r=-1;const i=As(e)?[e]:Kr(e),n=i.length,a=n-1;for(;++r<n;){const o=i[r];let c=t;if(r!==a){const u=s[o];c=X(u)||Array.isArray(u)?u:isNaN(+i[r+1])?{}:[]}if(o==="__proto__"||o==="constructor"||o==="prototype")return;s[o]=c,s=s[o]}};const fr={BLUR:"blur",FOCUS_OUT:"focusout"},ve={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Se={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},vo=B.createContext(null),bo=()=>B.useContext(vo);var wo=(s,e,t,r=!0)=>{const i={defaultValues:e._defaultValues};for(const n in s)Object.defineProperty(i,n,{get:()=>{const a=n;return e._proxyFormState[a]!==ve.all&&(e._proxyFormState[a]=!r||ve.all),s[a]}});return i};const _o=typeof window<"u"?T.useLayoutEffect:T.useEffect;var ke=s=>typeof s=="string",xo=(s,e,t,r,i)=>ke(s)?(r&&e.watch.add(s),O(t,s,i)):Array.isArray(s)?s.map(n=>(r&&e.watch.add(n),O(t,n))):(r&&(e.watchAll=!0),t),jo=(s,e,t,r,i)=>e?{...t[s],types:{...t[s]&&t[s].types?t[s].types:{},[r]:i||!0}}:{},ge=s=>Array.isArray(s)?s:[s],gr=()=>{let s=[];return{get observers(){return s},next:i=>{for(const n of s)n.next&&n.next(i)},subscribe:i=>(s.push(i),{unsubscribe:()=>{s=s.filter(n=>n!==i)}}),unsubscribe:()=>{s=[]}}},ps=s=>ce(s)||!Gr(s);function $e(s,e){if(ps(s)||ps(e))return s===e;if(Me(s)&&Me(e))return s.getTime()===e.getTime();const t=Object.keys(s),r=Object.keys(e);if(t.length!==r.length)return!1;for(const i of t){const n=s[i];if(!r.includes(i))return!1;if(i!=="ref"){const a=e[i];if(Me(n)&&Me(a)||X(n)&&X(a)||Array.isArray(n)&&Array.isArray(a)?!$e(n,a):n!==a)return!1}}return!0}var le=s=>X(s)&&!Object.keys(s).length,Es=s=>s.type==="file",xe=s=>typeof s=="function",Rt=s=>{if(!Ss)return!1;const e=s?s.ownerDocument:0;return s instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},Yr=s=>s.type==="select-multiple",Cs=s=>s.type==="radio",ko=s=>Cs(s)||bt(s),Xt=s=>Rt(s)&&s.isConnected;function So(s,e){const t=e.slice(0,-1).length;let r=0;for(;r<t;)s=K(s)?r++:s[e[r++]];return s}function Ao(s){for(const e in s)if(s.hasOwnProperty(e)&&!K(s[e]))return!1;return!0}function Z(s,e){const t=Array.isArray(e)?e:As(e)?[e]:Kr(e),r=t.length===1?s:So(s,t),i=t.length-1,n=t[i];return r&&delete r[n],i!==0&&(X(r)&&le(r)||Array.isArray(r)&&Ao(r))&&Z(s,t.slice(0,-1)),s}var Qr=s=>{for(const e in s)if(xe(s[e]))return!0;return!1};function $t(s,e={}){const t=Array.isArray(s);if(X(s)||t)for(const r in s)Array.isArray(s[r])||X(s[r])&&!Qr(s[r])?(e[r]=Array.isArray(s[r])?[]:{},$t(s[r],e[r])):ce(s[r])||(e[r]=!0);return e}function Xr(s,e,t){const r=Array.isArray(s);if(X(s)||r)for(const i in s)Array.isArray(s[i])||X(s[i])&&!Qr(s[i])?K(e)||ps(t[i])?t[i]=Array.isArray(s[i])?$t(s[i],[]):{...$t(s[i])}:Xr(s[i],ce(e)?{}:e[i],t[i]):t[i]=!$e(s[i],e[i]);return t}var ut=(s,e)=>Xr(s,e,$t(e));const mr={value:!1,isValid:!1},pr={value:!0,isValid:!0};var Zr=s=>{if(Array.isArray(s)){if(s.length>1){const e=s.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:e,isValid:!!e.length}}return s[0].checked&&!s[0].disabled?s[0].attributes&&!K(s[0].attributes.value)?K(s[0].value)||s[0].value===""?pr:{value:s[0].value,isValid:!0}:pr:mr}return mr},ei=(s,{valueAsNumber:e,valueAsDate:t,setValueAs:r})=>K(s)?s:e?s===""?NaN:s&&+s:t&&ke(s)?new Date(s):r?r(s):s;const yr={isValid:!1,value:null};var ti=s=>Array.isArray(s)?s.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,yr):yr;function vr(s){const e=s.ref;return Es(e)?e.files:Cs(e)?ti(s.refs).value:Yr(e)?[...e.selectedOptions].map(({value:t})=>t):bt(e)?Zr(s.refs).value:ei(K(e.value)?s.ref.value:e.value,s)}var Eo=(s,e,t,r)=>{const i={};for(const n of s){const a=O(e,n);a&&W(i,n,a._f)}return{criteriaMode:t,names:[...s],fields:i,shouldUseNativeValidation:r}},Lt=s=>s instanceof RegExp,dt=s=>K(s)?s:Lt(s)?s.source:X(s)?Lt(s.value)?s.value.source:s.value:s,et=s=>({isOnSubmit:!s||s===ve.onSubmit,isOnBlur:s===ve.onBlur,isOnChange:s===ve.onChange,isOnAll:s===ve.all,isOnTouch:s===ve.onTouched});const br="AsyncFunction";var Co=s=>!!s&&!!s.validate&&!!(xe(s.validate)&&s.validate.constructor.name===br||X(s.validate)&&Object.values(s.validate).find(e=>e.constructor.name===br)),Oo=s=>s.mount&&(s.required||s.min||s.max||s.maxLength||s.minLength||s.pattern||s.validate),ys=(s,e,t)=>!t&&(e.watchAll||e.watch.has(s)||[...e.watch].some(r=>s.startsWith(r)&&/^\.\w+/.test(s.slice(r.length))));const st=(s,e,t,r)=>{for(const i of t||Object.keys(s)){const n=O(s,i);if(n){const{_f:a,...o}=n;if(a){if(a.refs&&a.refs[0]&&e(a.refs[0],i)&&!r)return!0;if(a.ref&&e(a.ref,a.name)&&!r)return!0;if(st(o,e))break}else if(X(o)&&st(o,e))break}}};function wr(s,e,t){const r=O(s,t);if(r||As(t))return{error:r,name:t};const i=t.split(".");for(;i.length;){const n=i.join("."),a=O(e,n),o=O(s,n);if(a&&!Array.isArray(a)&&t!==n)return{name:t};if(o&&o.type)return{name:n,error:o};if(o&&o.root&&o.root.type)return{name:`${n}.root`,error:o.root};i.pop()}return{name:t}}var To=(s,e,t,r)=>{t(s);const{name:i,...n}=s;return le(n)||Object.keys(n).length>=Object.keys(e).length||Object.keys(n).find(a=>e[a]===(!r||ve.all))},No=(s,e,t)=>!s||!e||s===e||ge(s).some(r=>r&&(t?r===e:r.startsWith(e)||e.startsWith(r))),Io=(s,e,t,r,i)=>i.isOnAll?!1:!t&&i.isOnTouch?!(e||s):(t?r.isOnBlur:i.isOnBlur)?!s:(t?r.isOnChange:i.isOnChange)?s:!0,Po=(s,e)=>!wt(O(s,e)).length&&Z(s,e),si=(s,e,t)=>{const r=ge(O(s,t));return W(r,"root",e[t]),W(s,t,r),s},Ot=s=>ke(s);function _r(s,e,t="validate"){if(Ot(s)||Array.isArray(s)&&s.every(Ot)||je(s)&&!s)return{type:t,message:Ot(s)?s:"",ref:e}}var Xe=s=>X(s)&&!Lt(s)?s:{value:s,message:""},vs=async(s,e,t,r,i,n)=>{const{ref:a,refs:o,required:c,maxLength:u,minLength:d,min:f,max:g,pattern:m,validate:v,name:b,valueAsNumber:_,mount:N}=s._f,j=O(t,b);if(!N||e.has(b))return{};const k=o?o[0]:a,$=q=>{i&&k.reportValidity&&(k.setCustomValidity(je(q)?"":q||""),k.reportValidity())},L={},A=Cs(a),E=bt(a),U=A||E,V=(_||Es(a))&&K(a.value)&&K(j)||Rt(a)&&a.value===""||j===""||Array.isArray(j)&&!j.length,ae=jo.bind(null,b,r,L),te=(q,z,Y,ie=Se.maxLength,ne=Se.minLength)=>{const me=q?z:Y;L[b]={type:q?ie:ne,message:me,ref:a,...ae(q?ie:ne,me)}};if(n?!Array.isArray(j)||!j.length:c&&(!U&&(V||ce(j))||je(j)&&!j||E&&!Zr(o).isValid||A&&!ti(o).isValid)){const{value:q,message:z}=Ot(c)?{value:!!c,message:c}:Xe(c);if(q&&(L[b]={type:Se.required,message:z,ref:k,...ae(Se.required,z)},!r))return $(z),L}if(!V&&(!ce(f)||!ce(g))){let q,z;const Y=Xe(g),ie=Xe(f);if(!ce(j)&&!isNaN(j)){const ne=a.valueAsNumber||j&&+j;ce(Y.value)||(q=ne>Y.value),ce(ie.value)||(z=ne<ie.value)}else{const ne=a.valueAsDate||new Date(j),me=w=>new Date(new Date().toDateString()+" "+w),Ce=a.type=="time",be=a.type=="week";ke(Y.value)&&j&&(q=Ce?me(j)>me(Y.value):be?j>Y.value:ne>new Date(Y.value)),ke(ie.value)&&j&&(z=Ce?me(j)<me(ie.value):be?j<ie.value:ne<new Date(ie.value))}if((q||z)&&(te(!!q,Y.message,ie.message,Se.max,Se.min),!r))return $(L[b].message),L}if((u||d)&&!V&&(ke(j)||n&&Array.isArray(j))){const q=Xe(u),z=Xe(d),Y=!ce(q.value)&&j.length>+q.value,ie=!ce(z.value)&&j.length<+z.value;if((Y||ie)&&(te(Y,q.message,z.message),!r))return $(L[b].message),L}if(m&&!V&&ke(j)){const{value:q,message:z}=Xe(m);if(Lt(q)&&!j.match(q)&&(L[b]={type:Se.pattern,message:z,ref:a,...ae(Se.pattern,z)},!r))return $(z),L}if(v){if(xe(v)){const q=await v(j,t),z=_r(q,k);if(z&&(L[b]={...z,...ae(Se.validate,z.message)},!r))return $(z.message),L}else if(X(v)){let q={};for(const z in v){if(!le(q)&&!r)break;const Y=_r(await v[z](j,t),k,z);Y&&(q={...Y,...ae(z,Y.message)},$(Y.message),r&&(L[b]=q))}if(!le(q)&&(L[b]={ref:k,...q},!r))return L}}return $(!0),L};const Ro={mode:ve.onSubmit,reValidateMode:ve.onChange,shouldFocusError:!0};function $o(s={}){let e={...Ro,...s},t={submitCount:0,isDirty:!1,isReady:!1,isLoading:xe(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1};const r={};let i=X(e.defaultValues)||X(e.values)?Q(e.defaultValues||e.values)||{}:{},n=e.shouldUnregister?{}:Q(i),a={action:!1,mount:!1,watch:!1},o={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c,u=0;const d={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let f={...d};const g={array:gr(),state:gr()},m=e.criteriaMode===ve.all,v=h=>p=>{clearTimeout(u),u=setTimeout(h,p)},b=async h=>{if(!e.disabled&&(d.isValid||f.isValid||h)){const p=e.resolver?le((await E()).errors):await V(r,!0);p!==t.isValid&&g.state.next({isValid:p})}},_=(h,p)=>{!e.disabled&&(d.isValidating||d.validatingFields||f.isValidating||f.validatingFields)&&((h||Array.from(o.mount)).forEach(y=>{y&&(p?W(t.validatingFields,y,p):Z(t.validatingFields,y))}),g.state.next({validatingFields:t.validatingFields,isValidating:!le(t.validatingFields)}))},N=(h,p=[],y,C,S=!0,x=!0)=>{if(C&&y&&!e.disabled){if(a.action=!0,x&&Array.isArray(O(r,h))){const I=y(O(r,h),C.argA,C.argB);S&&W(r,h,I)}if(x&&Array.isArray(O(t.errors,h))){const I=y(O(t.errors,h),C.argA,C.argB);S&&W(t.errors,h,I),Po(t.errors,h)}if((d.touchedFields||f.touchedFields)&&x&&Array.isArray(O(t.touchedFields,h))){const I=y(O(t.touchedFields,h),C.argA,C.argB);S&&W(t.touchedFields,h,I)}(d.dirtyFields||f.dirtyFields)&&(t.dirtyFields=ut(i,n)),g.state.next({name:h,isDirty:te(h,p),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else W(n,h,p)},j=(h,p)=>{W(t.errors,h,p),g.state.next({errors:t.errors})},k=h=>{t.errors=h,g.state.next({errors:t.errors,isValid:!1})},$=(h,p,y,C)=>{const S=O(r,h);if(S){const x=O(n,h,K(y)?O(i,h):y);K(x)||C&&C.defaultChecked||p?W(n,h,p?x:vr(S._f)):Y(h,x),a.mount&&b()}},L=(h,p,y,C,S)=>{let x=!1,I=!1;const H={name:h};if(!e.disabled){if(!y||C){(d.isDirty||f.isDirty)&&(I=t.isDirty,t.isDirty=H.isDirty=te(),x=I!==H.isDirty);const J=$e(O(i,h),p);I=!!O(t.dirtyFields,h),J?Z(t.dirtyFields,h):W(t.dirtyFields,h,!0),H.dirtyFields=t.dirtyFields,x=x||(d.dirtyFields||f.dirtyFields)&&I!==!J}if(y){const J=O(t.touchedFields,h);J||(W(t.touchedFields,h,y),H.touchedFields=t.touchedFields,x=x||(d.touchedFields||f.touchedFields)&&J!==y)}x&&S&&g.state.next(H)}return x?H:{}},A=(h,p,y,C)=>{const S=O(t.errors,h),x=(d.isValid||f.isValid)&&je(p)&&t.isValid!==p;if(e.delayError&&y?(c=v(()=>j(h,y)),c(e.delayError)):(clearTimeout(u),c=null,y?W(t.errors,h,y):Z(t.errors,h)),(y?!$e(S,y):S)||!le(C)||x){const I={...C,...x&&je(p)?{isValid:p}:{},errors:t.errors,name:h};t={...t,...I},g.state.next(I)}},E=async h=>{_(h,!0);const p=await e.resolver(n,e.context,Eo(h||o.mount,r,e.criteriaMode,e.shouldUseNativeValidation));return _(h),p},U=async h=>{const{errors:p}=await E(h);if(h)for(const y of h){const C=O(p,y);C?W(t.errors,y,C):Z(t.errors,y)}else t.errors=p;return p},V=async(h,p,y={valid:!0})=>{for(const C in h){const S=h[C];if(S){const{_f:x,...I}=S;if(x){const H=o.array.has(x.name),J=S._f&&Co(S._f);J&&d.validatingFields&&_([C],!0);const pe=await vs(S,o.disabled,n,m,e.shouldUseNativeValidation&&!p,H);if(J&&d.validatingFields&&_([C]),pe[x.name]&&(y.valid=!1,p))break;!p&&(O(pe,x.name)?H?si(t.errors,pe,x.name):W(t.errors,x.name,pe[x.name]):Z(t.errors,x.name))}!le(I)&&await V(I,p,y)}}return y.valid},ae=()=>{for(const h of o.unMount){const p=O(r,h);p&&(p._f.refs?p._f.refs.every(y=>!Xt(y)):!Xt(p._f.ref))&&Ut(h)}o.unMount=new Set},te=(h,p)=>!e.disabled&&(h&&p&&W(n,h,p),!$e(w(),i)),q=(h,p,y)=>xo(h,o,{...a.mount?n:K(p)?i:ke(h)?{[h]:p}:p},y,p),z=h=>wt(O(a.mount?n:i,h,e.shouldUnregister?O(i,h,[]):[])),Y=(h,p,y={})=>{const C=O(r,h);let S=p;if(C){const x=C._f;x&&(!x.disabled&&W(n,h,ei(p,x)),S=Rt(x.ref)&&ce(p)?"":p,Yr(x.ref)?[...x.ref.options].forEach(I=>I.selected=S.includes(I.value)):x.refs?bt(x.ref)?x.refs.forEach(I=>{(!I.defaultChecked||!I.disabled)&&(Array.isArray(S)?I.checked=!!S.find(H=>H===I.value):I.checked=S===I.value||!!S)}):x.refs.forEach(I=>I.checked=I.value===S):Es(x.ref)?x.ref.value="":(x.ref.value=S,x.ref.type||g.state.next({name:h,values:Q(n)})))}(y.shouldDirty||y.shouldTouch)&&L(h,S,y.shouldTouch,y.shouldDirty,!0),y.shouldValidate&&be(h)},ie=(h,p,y)=>{for(const C in p){if(!p.hasOwnProperty(C))return;const S=p[C],x=h+"."+C,I=O(r,x);(o.array.has(h)||X(S)||I&&!I._f)&&!Me(S)?ie(x,S,y):Y(x,S,y)}},ne=(h,p,y={})=>{const C=O(r,h),S=o.array.has(h),x=Q(p);W(n,h,x),S?(g.array.next({name:h,values:Q(n)}),(d.isDirty||d.dirtyFields||f.isDirty||f.dirtyFields)&&y.shouldDirty&&g.state.next({name:h,dirtyFields:ut(i,n),isDirty:te(h,x)})):C&&!C._f&&!ce(x)?ie(h,x,y):Y(h,x,y),ys(h,o)&&g.state.next({...t}),g.state.next({name:a.mount?h:void 0,values:Q(n)})},me=async h=>{a.mount=!0;const p=h.target;let y=p.name,C=!0;const S=O(r,y),x=J=>{C=Number.isNaN(J)||Me(J)&&isNaN(J.getTime())||$e(J,O(n,y,J))},I=et(e.mode),H=et(e.reValidateMode);if(S){let J,pe;const _t=p.type?vr(S._f):go(h),Oe=h.type===fr.BLUR||h.type===fr.FOCUS_OUT,ui=!Oo(S._f)&&!e.resolver&&!O(t.errors,y)&&!S._f.deps||Io(Oe,O(t.touchedFields,y),t.isSubmitted,H,I),Vt=ys(y,o,Oe);W(n,y,_t),Oe?(S._f.onBlur&&S._f.onBlur(h),c&&c(0)):S._f.onChange&&S._f.onChange(h);const qt=L(y,_t,Oe),di=!le(qt)||Vt;if(!Oe&&g.state.next({name:y,type:h.type,values:Q(n)}),ui)return(d.isValid||f.isValid)&&(e.mode==="onBlur"?Oe&&b():Oe||b()),di&&g.state.next({name:y,...Vt?{}:qt});if(!Oe&&Vt&&g.state.next({...t}),e.resolver){const{errors:$s}=await E([y]);if(x(_t),C){const hi=wr(t.errors,r,y),Ls=wr($s,r,hi.name||y);J=Ls.error,y=Ls.name,pe=le($s)}}else _([y],!0),J=(await vs(S,o.disabled,n,m,e.shouldUseNativeValidation))[y],_([y]),x(_t),C&&(J?pe=!1:(d.isValid||f.isValid)&&(pe=await V(r,!0)));C&&(S._f.deps&&be(S._f.deps),A(y,pe,J,qt))}},Ce=(h,p)=>{if(O(t.errors,p)&&h.focus)return h.focus(),1},be=async(h,p={})=>{let y,C;const S=ge(h);if(e.resolver){const x=await U(K(h)?h:S);y=le(x),C=h?!S.some(I=>O(x,I)):y}else h?(C=(await Promise.all(S.map(async x=>{const I=O(r,x);return await V(I&&I._f?{[x]:I}:I)}))).every(Boolean),!(!C&&!t.isValid)&&b()):C=y=await V(r);return g.state.next({...!ke(h)||(d.isValid||f.isValid)&&y!==t.isValid?{}:{name:h},...e.resolver||!h?{isValid:y}:{},errors:t.errors}),p.shouldFocus&&!C&&st(r,Ce,h?S:o.mount),C},w=h=>{const p={...a.mount?n:i};return K(h)?p:ke(h)?O(p,h):h.map(y=>O(p,y))},P=(h,p)=>({invalid:!!O((p||t).errors,h),isDirty:!!O((p||t).dirtyFields,h),error:O((p||t).errors,h),isValidating:!!O(t.validatingFields,h),isTouched:!!O((p||t).touchedFields,h)}),R=h=>{h&&ge(h).forEach(p=>Z(t.errors,p)),g.state.next({errors:h?t.errors:{}})},ee=(h,p,y)=>{const C=(O(r,h,{_f:{}})._f||{}).ref,S=O(t.errors,h)||{},{ref:x,message:I,type:H,...J}=S;W(t.errors,h,{...J,...p,ref:C}),g.state.next({name:h,errors:t.errors,isValid:!1}),y&&y.shouldFocus&&C&&C.focus&&C.focus()},he=(h,p)=>xe(h)?g.state.subscribe({next:y=>h(q(void 0,p),y)}):q(h,p,!0),Os=h=>g.state.subscribe({next:p=>{No(h.name,p.name,h.exact)&&To(p,h.formState||d,ci,h.reRenderRoot)&&h.callback({values:{...n},...t,...p})}}).unsubscribe,ni=h=>(a.mount=!0,f={...f,...h.formState},Os({...h,formState:f})),Ut=(h,p={})=>{for(const y of h?ge(h):o.mount)o.mount.delete(y),o.array.delete(y),p.keepValue||(Z(r,y),Z(n,y)),!p.keepError&&Z(t.errors,y),!p.keepDirty&&Z(t.dirtyFields,y),!p.keepTouched&&Z(t.touchedFields,y),!p.keepIsValidating&&Z(t.validatingFields,y),!e.shouldUnregister&&!p.keepDefaultValue&&Z(i,y);g.state.next({values:Q(n)}),g.state.next({...t,...p.keepDirty?{isDirty:te()}:{}}),!p.keepIsValid&&b()},Ts=({disabled:h,name:p})=>{(je(h)&&a.mount||h||o.disabled.has(p))&&(h?o.disabled.add(p):o.disabled.delete(p))},Bt=(h,p={})=>{let y=O(r,h);const C=je(p.disabled)||je(e.disabled);return W(r,h,{...y||{},_f:{...y&&y._f?y._f:{ref:{name:h}},name:h,mount:!0,...p}}),o.mount.add(h),y?Ts({disabled:je(p.disabled)?p.disabled:e.disabled,name:h}):$(h,!0,p.value),{...C?{disabled:p.disabled||e.disabled}:{},...e.progressive?{required:!!p.required,min:dt(p.min),max:dt(p.max),minLength:dt(p.minLength),maxLength:dt(p.maxLength),pattern:dt(p.pattern)}:{},name:h,onChange:me,onBlur:me,ref:S=>{if(S){Bt(h,p),y=O(r,h);const x=K(S.value)&&S.querySelectorAll&&S.querySelectorAll("input,select,textarea")[0]||S,I=ko(x),H=y._f.refs||[];if(I?H.find(J=>J===x):x===y._f.ref)return;W(r,h,{_f:{...y._f,...I?{refs:[...H.filter(Xt),x,...Array.isArray(O(i,h))?[{}]:[]],ref:{type:x.type,name:h}}:{ref:x}}}),$(h,!1,void 0,x)}else y=O(r,h,{}),y._f&&(y._f.mount=!1),(e.shouldUnregister||p.shouldUnregister)&&!(po(o.array,h)&&a.action)&&o.unMount.add(h)}}},Mt=()=>e.shouldFocusError&&st(r,Ce,o.mount),ai=h=>{je(h)&&(g.state.next({disabled:h}),st(r,(p,y)=>{const C=O(r,y);C&&(p.disabled=C._f.disabled||h,Array.isArray(C._f.refs)&&C._f.refs.forEach(S=>{S.disabled=C._f.disabled||h}))},0,!1))},Ns=(h,p)=>async y=>{let C;y&&(y.preventDefault&&y.preventDefault(),y.persist&&y.persist());let S=Q(n);if(g.state.next({isSubmitting:!0}),e.resolver){const{errors:x,values:I}=await E();t.errors=x,S=I}else await V(r);if(o.disabled.size)for(const x of o.disabled)W(S,x,void 0);if(Z(t.errors,"root"),le(t.errors)){g.state.next({errors:{}});try{await h(S,y)}catch(x){C=x}}else p&&await p({...t.errors},y),Mt(),setTimeout(Mt);if(g.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:le(t.errors)&&!C,submitCount:t.submitCount+1,errors:t.errors}),C)throw C},oi=(h,p={})=>{O(r,h)&&(K(p.defaultValue)?ne(h,Q(O(i,h))):(ne(h,p.defaultValue),W(i,h,Q(p.defaultValue))),p.keepTouched||Z(t.touchedFields,h),p.keepDirty||(Z(t.dirtyFields,h),t.isDirty=p.defaultValue?te(h,Q(O(i,h))):te()),p.keepError||(Z(t.errors,h),d.isValid&&b()),g.state.next({...t}))},Is=(h,p={})=>{const y=h?Q(h):i,C=Q(y),S=le(h),x=S?i:C;if(p.keepDefaultValues||(i=y),!p.keepValues){if(p.keepDirtyValues){const I=new Set([...o.mount,...Object.keys(ut(i,n))]);for(const H of Array.from(I))O(t.dirtyFields,H)?W(x,H,O(n,H)):ne(H,O(x,H))}else{if(Ss&&K(h))for(const I of o.mount){const H=O(r,I);if(H&&H._f){const J=Array.isArray(H._f.refs)?H._f.refs[0]:H._f.ref;if(Rt(J)){const pe=J.closest("form");if(pe){pe.reset();break}}}}for(const I of o.mount)ne(I,O(x,I))}n=Q(x),g.array.next({values:{...x}}),g.state.next({values:{...x}})}o={mount:p.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!d.isValid||!!p.keepIsValid||!!p.keepDirtyValues,a.watch=!!e.shouldUnregister,g.state.next({submitCount:p.keepSubmitCount?t.submitCount:0,isDirty:S?!1:p.keepDirty?t.isDirty:!!(p.keepDefaultValues&&!$e(h,i)),isSubmitted:p.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:S?{}:p.keepDirtyValues?p.keepDefaultValues&&n?ut(i,n):t.dirtyFields:p.keepDefaultValues&&h?ut(i,h):p.keepDirty?t.dirtyFields:{},touchedFields:p.keepTouched?t.touchedFields:{},errors:p.keepErrors?t.errors:{},isSubmitSuccessful:p.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1})},Ps=(h,p)=>Is(xe(h)?h(n):h,p),li=(h,p={})=>{const y=O(r,h),C=y&&y._f;if(C){const S=C.refs?C.refs[0]:C.ref;S.focus&&(S.focus(),p.shouldSelect&&xe(S.select)&&S.select())}},ci=h=>{t={...t,...h}},Rs={control:{register:Bt,unregister:Ut,getFieldState:P,handleSubmit:Ns,setError:ee,_subscribe:Os,_runSchema:E,_focusError:Mt,_getWatch:q,_getDirty:te,_setValid:b,_setFieldArray:N,_setDisabledField:Ts,_setErrors:k,_getFieldArray:z,_reset:Is,_resetDefaultValues:()=>xe(e.defaultValues)&&e.defaultValues().then(h=>{Ps(h,e.resetOptions),g.state.next({isLoading:!1})}),_removeUnmounted:ae,_disableForm:ai,_subjects:g,_proxyFormState:d,get _fields(){return r},get _formValues(){return n},get _state(){return a},set _state(h){a=h},get _defaultValues(){return i},get _names(){return o},set _names(h){o=h},get _formState(){return t},get _options(){return e},set _options(h){e={...e,...h}}},subscribe:ni,trigger:be,register:Bt,handleSubmit:Ns,watch:he,setValue:ne,getValues:w,reset:Ps,resetField:oi,clearErrors:R,unregister:Ut,setError:ee,setFocus:li,getFieldState:P};return{...Rs,formControl:Rs}}var Ne=()=>{const s=typeof performance>"u"?Date.now():performance.now()*1e3;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=(Math.random()*16+s)%16|0;return(e=="x"?t:t&3|8).toString(16)})},Zt=(s,e,t={})=>t.shouldFocus||K(t.shouldFocus)?t.focusName||`${s}.${K(t.focusIndex)?e:t.focusIndex}.`:"",es=(s,e)=>[...s,...ge(e)],ts=s=>Array.isArray(s)?s.map(()=>{}):void 0;function ss(s,e,t){return[...s.slice(0,e),...ge(t),...s.slice(e)]}var rs=(s,e,t)=>Array.isArray(s)?(K(s[t])&&(s[t]=void 0),s.splice(t,0,s.splice(e,1)[0]),s):[],is=(s,e)=>[...ge(e),...ge(s)];function Lo(s,e){let t=0;const r=[...s];for(const i of e)r.splice(i-t,1),t++;return wt(r).length?r:[]}var ns=(s,e)=>K(e)?[]:Lo(s,ge(e).sort((t,r)=>t-r)),as=(s,e,t)=>{[s[e],s[t]]=[s[t],s[e]]},xr=(s,e,t)=>(s[e]=t,s);function ri(s){const e=bo(),{control:t=e.control,name:r,keyName:i="id",shouldUnregister:n,rules:a}=s,[o,c]=B.useState(t._getFieldArray(r)),u=B.useRef(t._getFieldArray(r).map(Ne)),d=B.useRef(o),f=B.useRef(r),g=B.useRef(!1);f.current=r,d.current=o,t._names.array.add(r),a&&t.register(r,a),B.useEffect(()=>t._subjects.array.subscribe({next:({values:A,name:E})=>{if(E===f.current||!E){const U=O(A,f.current);Array.isArray(U)&&(c(U),u.current=U.map(Ne))}}}).unsubscribe,[t]);const m=B.useCallback(A=>{g.current=!0,t._setFieldArray(r,A)},[t,r]),v=(A,E)=>{const U=ge(Q(A)),V=es(t._getFieldArray(r),U);t._names.focus=Zt(r,V.length-1,E),u.current=es(u.current,U.map(Ne)),m(V),c(V),t._setFieldArray(r,V,es,{argA:ts(A)})},b=(A,E)=>{const U=ge(Q(A)),V=is(t._getFieldArray(r),U);t._names.focus=Zt(r,0,E),u.current=is(u.current,U.map(Ne)),m(V),c(V),t._setFieldArray(r,V,is,{argA:ts(A)})},_=A=>{const E=ns(t._getFieldArray(r),A);u.current=ns(u.current,A),m(E),c(E),!Array.isArray(O(t._fields,r))&&W(t._fields,r,void 0),t._setFieldArray(r,E,ns,{argA:A})},N=(A,E,U)=>{const V=ge(Q(E)),ae=ss(t._getFieldArray(r),A,V);t._names.focus=Zt(r,A,U),u.current=ss(u.current,A,V.map(Ne)),m(ae),c(ae),t._setFieldArray(r,ae,ss,{argA:A,argB:ts(E)})},j=(A,E)=>{const U=t._getFieldArray(r);as(U,A,E),as(u.current,A,E),m(U),c(U),t._setFieldArray(r,U,as,{argA:A,argB:E},!1)},k=(A,E)=>{const U=t._getFieldArray(r);rs(U,A,E),rs(u.current,A,E),m(U),c(U),t._setFieldArray(r,U,rs,{argA:A,argB:E},!1)},$=(A,E)=>{const U=Q(E),V=xr(t._getFieldArray(r),A,U);u.current=[...V].map((ae,te)=>!ae||te===A?Ne():u.current[te]),m(V),c([...V]),t._setFieldArray(r,V,xr,{argA:A,argB:U},!0,!1)},L=A=>{const E=ge(Q(A));u.current=E.map(Ne),m([...E]),c([...E]),t._setFieldArray(r,[...E],U=>U,{},!0,!1)};return B.useEffect(()=>{if(t._state.action=!1,ys(r,t._names)&&t._subjects.state.next({...t._formState}),g.current&&(!et(t._options.mode).isOnSubmit||t._formState.isSubmitted)&&!et(t._options.reValidateMode).isOnSubmit)if(t._options.resolver)t._runSchema([r]).then(A=>{const E=O(A.errors,r),U=O(t._formState.errors,r);(U?!E&&U.type||E&&(U.type!==E.type||U.message!==E.message):E&&E.type)&&(E?W(t._formState.errors,r,E):Z(t._formState.errors,r),t._subjects.state.next({errors:t._formState.errors}))});else{const A=O(t._fields,r);A&&A._f&&!(et(t._options.reValidateMode).isOnSubmit&&et(t._options.mode).isOnSubmit)&&vs(A,t._names.disabled,t._formValues,t._options.criteriaMode===ve.all,t._options.shouldUseNativeValidation,!0).then(E=>!le(E)&&t._subjects.state.next({errors:si(t._formState.errors,E,r)}))}t._subjects.state.next({name:r,values:Q(t._formValues)}),t._names.focus&&st(t._fields,(A,E)=>{if(t._names.focus&&E.startsWith(t._names.focus)&&A.focus)return A.focus(),1}),t._names.focus="",t._setValid(),g.current=!1},[o,r,t]),B.useEffect(()=>(!O(t._formValues,r)&&t._setFieldArray(r),()=>{const A=(E,U)=>{const V=O(t._fields,E);V&&V._f&&(V._f.mount=U)};t._options.shouldUnregister||n?t.unregister(r):A(r,!1)}),[r,t,i,n]),{swap:B.useCallback(j,[m,r,t]),move:B.useCallback(k,[m,r,t]),prepend:B.useCallback(b,[m,r,t]),append:B.useCallback(v,[m,r,t]),remove:B.useCallback(_,[m,r,t]),insert:B.useCallback(N,[m,r,t]),update:B.useCallback($,[m,r,t]),replace:B.useCallback(L,[m,r,t]),fields:B.useMemo(()=>o.map((A,E)=>({...A,[i]:u.current[E]||Ne()})),[o,i])}}function ii(s={}){const e=B.useRef(void 0),t=B.useRef(void 0),[r,i]=B.useState({isDirty:!1,isValidating:!1,isLoading:xe(s.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1,isReady:!1,defaultValues:xe(s.defaultValues)?void 0:s.defaultValues});e.current||(e.current={...s.formControl?s.formControl:$o(s),formState:r},s.formControl&&s.defaultValues&&!xe(s.defaultValues)&&s.formControl.reset(s.defaultValues,s.resetOptions));const n=e.current.control;return n._options=s,_o(()=>{const a=n._subscribe({formState:n._proxyFormState,callback:()=>i({...n._formState}),reRenderRoot:!0});return i(o=>({...o,isReady:!0})),n._formState.isReady=!0,a},[n]),B.useEffect(()=>n._disableForm(s.disabled),[n,s.disabled]),B.useEffect(()=>{s.mode&&(n._options.mode=s.mode),s.reValidateMode&&(n._options.reValidateMode=s.reValidateMode)},[n,s.mode,s.reValidateMode]),B.useEffect(()=>{s.errors&&(n._setErrors(s.errors),n._focusError())},[n,s.errors]),B.useEffect(()=>{s.shouldUnregister&&n._subjects.state.next({values:n._getWatch()})},[n,s.shouldUnregister]),B.useEffect(()=>{if(n._proxyFormState.isDirty){const a=n._getDirty();a!==r.isDirty&&n._subjects.state.next({isDirty:a})}},[n,r.isDirty]),B.useEffect(()=>{s.values&&!$e(s.values,t.current)?(n._reset(s.values,n._options.resetOptions),t.current=s.values,i(a=>({...a}))):n._resetDefaultValues()},[n,s.values]),B.useEffect(()=>{n._state.mount||(n._setValid(),n._state.mount=!0),n._state.watch&&(n._state.watch=!1,n._subjects.state.next({...n._formState})),n._removeUnmounted()}),e.current.formState=wo(r,n),e.current}const Fo=({isOpen:s,onClose:e,onSave:t})=>{const[r,i]=T.useState(!1),{register:n,handleSubmit:a,control:o,formState:{errors:c}}=ii({defaultValues:{status:"coming_soon",is_visible:!0,content_blocks:[]}}),{fields:u,append:d,remove:f,move:g}=ri({control:o,name:"content_blocks"}),m=async v=>{try{i(!0),await t(v),e()}catch(b){console.error("Error saving game:",b)}finally{i(!1)}};return l.jsx(Ft,{children:s&&l.jsx(F.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:l.jsxs(F.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"bg-gray-900 rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[l.jsx("h2",{className:"text-2xl font-bold mb-6 text-white",children:"افزودن بازی جدید"}),l.jsxs("form",{onSubmit:a(m),className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"اسلاگ"}),l.jsx("input",{...n("slug",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"عنوان"}),l.jsx("input",{...n("title",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"توضیحات"}),l.jsx("textarea",{...n("description",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2",rows:3})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"آدرس آیکون"}),l.jsx("input",{...n("image_icon",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"آدرس دانلود"}),l.jsx("input",{...n("download_url",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2"})]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"وضعیت"}),l.jsxs("select",{...n("status",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2",children:[l.jsx("option",{value:"in_progress",children:"در حال ساخت"}),l.jsx("option",{value:"released",children:"ساخته شده"}),l.jsx("option",{value:"coming_soon",children:"به زودی"})]})]}),l.jsx("div",{className:"flex items-center",children:l.jsxs("label",{className:"flex items-center text-gray-300",children:[l.jsx("input",{type:"checkbox",...n("is_visible"),className:"ml-2"}),"قابل مشاهده"]})})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h3",{className:"text-lg font-medium text-white",children:"بلوک‌های محتوا"}),l.jsxs("div",{className:"space-x-2",children:[l.jsx("button",{type:"button",onClick:()=>d({type:"image",src:"",alt:""}),className:"bg-blue-500 text-white px-3 py-1 rounded-lg text-sm",children:"افزودن تصویر"}),l.jsx("button",{type:"button",onClick:()=>d({type:"video",src:"",caption:""}),className:"bg-green-500 text-white px-3 py-1 rounded-lg text-sm",children:"افزودن ویدیو"}),l.jsx("button",{type:"button",onClick:()=>d({type:"text",content:""}),className:"bg-purple-500 text-white px-3 py-1 rounded-lg text-sm",children:"افزودن متن"})]})]}),l.jsx("div",{className:"space-y-4",children:u.map((v,b)=>l.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsxs("select",{...n(`content_blocks.${b}.type`),className:"bg-gray-700 text-white rounded-lg p-2",children:[l.jsx("option",{value:"image",children:"تصویر"}),l.jsx("option",{value:"video",children:"ویدیو"}),l.jsx("option",{value:"text",children:"متن"})]}),l.jsxs("div",{className:"space-x-2",children:[b>0&&l.jsx("button",{type:"button",onClick:()=>g(b,b-1),className:"text-gray-300 hover:text-white",children:"↑"}),b<u.length-1&&l.jsx("button",{type:"button",onClick:()=>g(b,b+1),className:"text-gray-300 hover:text-white",children:"↓"}),l.jsx("button",{type:"button",onClick:()=>f(b),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]}),v.type==="image"&&l.jsxs(l.Fragment,{children:[l.jsx("input",{...n(`content_blocks.${b}.src`),placeholder:"آدرس تصویر",className:"w-full bg-gray-700 text-white rounded-lg p-2 mb-2"}),l.jsx("input",{...n(`content_blocks.${b}.alt`),placeholder:"متن جایگزین",className:"w-full bg-gray-700 text-white rounded-lg p-2"})]}),v.type==="video"&&l.jsxs(l.Fragment,{children:[l.jsx("input",{...n(`content_blocks.${b}.src`),placeholder:"آدرس ویدیو",className:"w-full bg-gray-700 text-white rounded-lg p-2 mb-2"}),l.jsx("input",{...n(`content_blocks.${b}.caption`),placeholder:"عنوان ویدیو",className:"w-full bg-gray-700 text-white rounded-lg p-2"})]}),v.type==="text"&&l.jsx("textarea",{...n(`content_blocks.${b}.content`),placeholder:"متن",className:"w-full bg-gray-700 text-white rounded-lg p-2",rows:3})]},v.id))})]}),l.jsxs("div",{className:"flex justify-end space-x-4",children:[l.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-gray-300 hover:text-white",children:"انصراف"}),l.jsx("button",{type:"submit",disabled:r,className:"bg-[#F4B744] text-black font-bold px-6 py-2 rounded-lg hover:bg-[#E5A93D] disabled:opacity-50",children:r?"در حال ذخیره...":"افزودن بازی"})]})]})]})})})},Do=()=>{const[s,e]=T.useState([]),[t,r]=T.useState(!1),[i,n]=T.useState(!1),[a,o]=T.useState(!0);T.useEffect(()=>{const u=async()=>{var g;const{data:{session:f}}=await ue.auth.getSession();r(((g=f==null?void 0:f.user)==null?void 0:g.email)==="active.legendss@gmail.com")},d=async()=>{try{const{data:f,error:g}=await ue.from("games").select("*").eq("is_visible",!0);if(g)throw g;e(f||[])}catch(f){console.error("Error fetching games:",f)}finally{o(!1)}};u(),d()},[]);const c=async u=>{try{const{data:d,error:f}=await ue.from("games").insert([u]).select().single();if(f)throw f;e([...s,d])}catch(d){throw console.error("Error adding game:",d),d}};return a?l.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:l.jsx("div",{className:"text-white text-xl",children:"در حال بارگذاری..."})}):l.jsxs("div",{className:"min-h-screen bg-black p-4 md:p-8",children:[l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-8",children:s.map(u=>l.jsx(Jr,{game:u},u.id))}),t&&l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:()=>n(!0),className:"fixed bottom-8 left-8 bg-green-600 text-white px-5 py-3 rounded-full shadow-lg hover:bg-green-700 transition-all",children:"افزودن بازی جدید"}),l.jsx(Fo,{isOpen:i,onClose:()=>n(!1),onSave:c})]})]})},Uo=({block:s,index:e})=>{const[t,r]=T.useState(0),[i,n]=T.useState(!0),a=T.useRef(null),{scrollY:o}=pi();T.useEffect(()=>{const g=()=>{const m=window.scrollY;n(m>t),r(m)};return window.addEventListener("scroll",g,{passive:!0}),()=>window.removeEventListener("scroll",g)},[t]);const u=e%2===0?"w-full flex justify-end mb-8":"w-full flex justify-start mb-8",d=()=>({initial:{opacity:0,y:i?-50:50},whileInView:{opacity:1,y:0},viewport:{once:!1,amount:.3,margin:"100px"},transition:{duration:.7,ease:"easeOut"}}),f=()=>s.type==="image"?l.jsx("img",{src:s.src,alt:s.alt,className:"w-full md:w-3/4 rounded-2xl shadow-xl object-cover"}):s.type==="video"?l.jsx("div",{className:"w-full md:w-3/4 rounded-2xl overflow-hidden shadow-xl",children:l.jsx("iframe",{src:s.src,title:s.caption||"ویدیو بازی",className:"w-full h-64 md:h-96",frameBorder:"0",allow:"autoplay; encrypted-media",allowFullScreen:!0})}):s.type==="text"?l.jsx("div",{className:"w-full bg-gray-900 text-gray-100 p-6 rounded-2xl",children:l.jsx("p",{className:"text-lg leading-relaxed font-medium",children:s.content})}):null;return l.jsx(F.div,{ref:a,...d(),className:s.type==="text"?"w-full mb-8":u,children:f()})},Bo=({game:s,isOpen:e,onClose:t,onSave:r})=>{const[i,n]=T.useState(!1),{register:a,handleSubmit:o,control:c,formState:{errors:u}}=ii({defaultValues:s}),{fields:d,append:f,remove:g,move:m}=ri({control:c,name:"content_blocks"}),v=async b=>{try{n(!0),await r(b),t()}catch(_){console.error("Error saving game:",_)}finally{n(!1)}};return l.jsx(Ft,{children:e&&l.jsx(F.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:l.jsxs(F.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"bg-gray-900 rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[l.jsx("h2",{className:"text-2xl font-bold mb-6 text-white",children:"ویرایش بازی"}),l.jsxs("form",{onSubmit:o(v),className:"space-y-6",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"اسلاگ"}),l.jsx("input",{...a("slug",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"عنوان"}),l.jsx("input",{...a("title",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"توضیحات"}),l.jsx("textarea",{...a("description",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2",rows:3})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"آدرس آیکون"}),l.jsx("input",{...a("image_icon",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"آدرس دانلود"}),l.jsx("input",{...a("download_url",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2"})]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"وضعیت"}),l.jsxs("select",{...a("status",{required:!0}),className:"w-full bg-gray-800 text-white rounded-lg p-2",children:[l.jsx("option",{value:"in_progress",children:"در حال ساخت"}),l.jsx("option",{value:"released",children:"ساخته شده"}),l.jsx("option",{value:"coming_soon",children:"به زودی"})]})]}),l.jsx("div",{className:"flex items-center",children:l.jsxs("label",{className:"flex items-center text-gray-300",children:[l.jsx("input",{type:"checkbox",...a("is_visible"),className:"ml-2"}),"قابل مشاهده"]})})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h3",{className:"text-lg font-medium text-white",children:"بلوک‌های محتوا"}),l.jsxs("div",{className:"space-x-2",children:[l.jsx("button",{type:"button",onClick:()=>f({type:"image",src:"",alt:""}),className:"bg-blue-500 text-white px-3 py-1 rounded-lg text-sm",children:"افزودن تصویر"}),l.jsx("button",{type:"button",onClick:()=>f({type:"video",src:"",caption:""}),className:"bg-green-500 text-white px-3 py-1 rounded-lg text-sm",children:"افزودن ویدیو"}),l.jsx("button",{type:"button",onClick:()=>f({type:"text",content:""}),className:"bg-purple-500 text-white px-3 py-1 rounded-lg text-sm",children:"افزودن متن"})]})]}),l.jsx("div",{className:"space-y-4",children:d.map((b,_)=>l.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsxs("select",{...a(`content_blocks.${_}.type`),className:"bg-gray-700 text-white rounded-lg p-2",children:[l.jsx("option",{value:"image",children:"تصویر"}),l.jsx("option",{value:"video",children:"ویدیو"}),l.jsx("option",{value:"text",children:"متن"})]}),l.jsxs("div",{className:"space-x-2",children:[_>0&&l.jsx("button",{type:"button",onClick:()=>m(_,_-1),className:"text-gray-300 hover:text-white",children:"↑"}),_<d.length-1&&l.jsx("button",{type:"button",onClick:()=>m(_,_+1),className:"text-gray-300 hover:text-white",children:"↓"}),l.jsx("button",{type:"button",onClick:()=>g(_),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]}),b.type==="image"&&l.jsxs(l.Fragment,{children:[l.jsx("input",{...a(`content_blocks.${_}.src`),placeholder:"آدرس تصویر",className:"w-full bg-gray-700 text-white rounded-lg p-2 mb-2"}),l.jsx("input",{...a(`content_blocks.${_}.alt`),placeholder:"متن جایگزین",className:"w-full bg-gray-700 text-white rounded-lg p-2"})]}),b.type==="video"&&l.jsxs(l.Fragment,{children:[l.jsx("input",{...a(`content_blocks.${_}.src`),placeholder:"آدرس ویدیو",className:"w-full bg-gray-700 text-white rounded-lg p-2 mb-2"}),l.jsx("input",{...a(`content_blocks.${_}.caption`),placeholder:"عنوان ویدیو",className:"w-full bg-gray-700 text-white rounded-lg p-2"})]}),b.type==="text"&&l.jsx("textarea",{...a(`content_blocks.${_}.content`),placeholder:"متن",className:"w-full bg-gray-700 text-white rounded-lg p-2",rows:3})]},b.id))})]}),l.jsxs("div",{className:"flex justify-end space-x-4",children:[l.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-300 hover:text-white",children:"انصراف"}),l.jsx("button",{type:"submit",disabled:i,className:"bg-[#F4B744] text-black font-bold px-6 py-2 rounded-lg hover:bg-[#E5A93D] disabled:opacity-50",children:i?"در حال ذخیره...":"ذخیره تغییرات"})]})]})]})})})},Mo=({gameId:s,className:e=""})=>{const[t,r]=T.useState(!1),[i,n]=T.useState(!0);T.useEffect(()=>{a();const c=ue.channel("favorites_changes").on("postgres_changes",{event:"*",schema:"public",table:"favorites",filter:`game_id=eq.${s}`},()=>{a()}).subscribe();return()=>{c.unsubscribe()}},[s]);const a=async()=>{try{const{data:{session:c}}=await ue.auth.getSession();if(!(c!=null&&c.user)){n(!1);return}const{data:u,error:d}=await ue.from("favorites").select("id").eq("game_id",s).eq("user_id",c.user.id).single();if(d&&d.code!=="PGRST116")throw d;r(!!u)}catch(c){console.error("Error checking favorite status:",c)}finally{n(!1)}},o=async()=>{try{n(!0);const{data:{session:c}}=await ue.auth.getSession();if(!(c!=null&&c.user))return;if(t){const{error:u}=await ue.from("favorites").delete().eq("game_id",s).eq("user_id",c.user.id);if(u)throw u;r(!1)}else{const{error:u}=await ue.from("favorites").insert([{game_id:s,user_id:c.user.id}]);if(u)throw u;r(!0)}}catch(c){console.error("Error toggling favorite:",c)}finally{n(!1)}};return i?l.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-gray-800 text-gray-300",children:[l.jsx("span",{className:"animate-pulse",children:"❤️"}),l.jsx("span",{className:"text-sm font-medium",children:"در حال بارگذاری..."})]}):l.jsxs(F.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:o,disabled:i,className:`flex items-center gap-2 px-4 py-2 rounded-full transition-colors ${t?"bg-red-500 text-white hover:bg-red-600":"bg-gray-800 text-gray-300 hover:bg-gray-700"} ${e}`,children:[l.jsx(F.span,{animate:{scale:t?[1,1.2,1]:1},transition:{duration:.3},children:"❤️"}),l.jsx("span",{className:"text-sm font-medium",children:t?"حذف از علاقه‌مندی‌ها":"افزودن به علاقه‌مندی‌ها"})]})},Vo=()=>{const{slug:s}=_i(),e=bs(),{user:t}=nt(),[r,i]=T.useState(null),[n,a]=T.useState(!1),[o,c]=T.useState(!1),[u,d]=T.useState(!0);T.useEffect(()=>{const g=async()=>{var b;const{data:{session:v}}=await ue.auth.getSession();a(((b=v==null?void 0:v.user)==null?void 0:b.email)==="active.legendss@gmail.com")},m=async()=>{if(s)try{const{data:v,error:b}=await ue.from("games").select("*").eq("slug",s).single();if(b)throw b;if(!v||!v.is_visible){e("/404");return}i(v)}catch(v){console.error("Error fetching game:",v),e("/404")}finally{d(!1)}};g(),m()},[s,e]);const f=async g=>{try{const{data:m,error:v}=await ue.from("games").update(g).eq("id",r==null?void 0:r.id).select().single();if(v)throw v;i(m)}catch(m){throw console.error("Error updating game:",m),m}};return u?l.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:l.jsx("div",{className:"text-white text-xl",children:"در حال بارگذاری..."})}):r?l.jsx("div",{className:"min-h-screen bg-black",children:l.jsxs("div",{className:"max-w-4xl mx-auto p-4 md:p-8",children:[l.jsxs("div",{className:"mb-8",children:[l.jsx("h1",{className:"text-3xl font-extrabold text-white mb-4",children:r.title}),l.jsx("p",{className:"text-base font-medium text-gray-300 mb-6",children:r.description}),l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("a",{href:r.download_url,target:"_blank",rel:"noopener noreferrer",className:"inline-block bg-[#F4B744] text-black font-bold px-6 py-3 rounded-2xl hover:scale-105 transition-all duration-200",children:"دانلود بازی"}),t&&r&&l.jsx(Mo,{gameId:r.id}),n&&l.jsx("button",{onClick:()=>c(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-2xl hover:scale-105 transition-all duration-200",children:"ویرایش بازی"})]})]}),l.jsx("div",{className:"space-y-8",children:r.content_blocks.map((g,m)=>l.jsx(Uo,{block:g,index:m},m))}),n&&l.jsx(Bo,{game:r,isOpen:o,onClose:()=>c(!1),onSave:f})]})}):l.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:l.jsx("div",{className:"text-white text-xl",children:"بازی یافت نشد"})})};function qo(){const s=bs();return l.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center px-4",children:l.jsxs("div",{className:"text-center",children:[l.jsx(F.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-6xl font-bold mb-4 font-vazirmatn",children:"۴۰۴"}),l.jsx(F.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-gray-400 mb-8 font-vazirmatn",children:"صفحه مورد نظر یافت نشد"}),l.jsx(F.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},onClick:()=>s("/"),className:"bg-[#F4B744] text-black px-6 py-2 rounded-lg font-medium hover:bg-[#F4B744]/90 transition-colors",children:"بازگشت به خانه"})]})})}const zo=()=>{const[s,e]=T.useState([]),[t,r]=T.useState(!0);return T.useEffect(()=>{(async()=>{try{const{data:{session:n}}=await ue.auth.getSession();if(!(n!=null&&n.user)){r(!1);return}const{data:a,error:o}=await ue.from("favorites").select("game_id").eq("user_id",n.user.id);if(o)throw o;if(a&&a.length>0){const c=a.map(f=>f.game_id),{data:u,error:d}=await ue.from("games").select("*").in("id",c).eq("is_visible",!0);if(d)throw d;e(u||[])}}catch(n){console.error("Error fetching favorite games:",n)}finally{r(!1)}})()},[]),t?l.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:l.jsx("div",{className:"text-white text-xl",children:"در حال بارگذاری..."})}):l.jsxs("div",{className:"min-h-screen bg-black p-4 md:p-8",children:[l.jsx(F.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-3xl font-bold text-white mb-8 text-center",children:"🎮 موارد دلخواه"}),s.length>0?l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-8",children:s.map(i=>l.jsx(Jr,{game:i},i.id))}):l.jsx(F.p,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-gray-400 text-lg",children:"بازی مورد علاقه‌ای اضافه نشده است."})]})};function Ho(){return T.useEffect(()=>{document.body.style.overscrollBehavior="none";const s=()=>{};return window.addEventListener("scroll",s,{passive:!0}),()=>{window.removeEventListener("scroll",s)}},[]),l.jsx(xi,{children:l.jsx(Ia,{children:l.jsxs("div",{className:"min-h-screen relative scroll-container",children:[l.jsx(Za,{}),l.jsxs("div",{className:"relative z-20",children:[l.jsx(Ka,{}),l.jsxs(ji,{children:[l.jsx(at,{path:"/",element:l.jsxs(l.Fragment,{children:[l.jsx(Qa,{}),l.jsx(co,{})]})}),l.jsx(at,{path:"/games",element:l.jsx(Do,{})}),l.jsx(at,{path:"/games/:slug",element:l.jsx(Vo,{})}),l.jsx(at,{path:"/my-games",element:l.jsx(zo,{})}),l.jsx(at,{path:"*",element:l.jsx(qo,{})})]})]})]})})})}Si.createRoot(document.getElementById("root")).render(l.jsx(T.StrictMode,{children:l.jsx(Ho,{})}));
//# sourceMappingURL=index-DPn8didP.js.map
